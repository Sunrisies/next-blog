æœ¬æ–‡æˆ‘å’Œå¤§å®¶ä¸€èµ·æ¢å¯»ä¸€ä¸‹æµè§ˆå™¨ä¸‹çš„ JavaScript ç¯å¢ƒï¼Œæˆ‘ä»¬ä¸ä»…ä»…è¦ä¼šç”¨ï¼Œå¦‚æœèƒ½è¿›ä¸€æ­¥äº†è§£å…¶ç»“æ„å°±æœ€å¥½ï¼Œå¦‚æœå°†æ¥é‡åˆ°ä¸€äº›ç‰¹æ®Šçš„éœ€æ±‚ï¼Œèƒ½æ‰©å±•å¯å®ç°çš„æ€è·¯ã€‚é€€ä¸€æ­¥è®²ï¼ŒæŒæ¡æµè§ˆå™¨è¿è¡Œç¯å¢ƒçš„æ›´å¤šç‰¹å¾ï¼Œä¹Ÿæœ‰åŠ©äºæå‡ä»£ç çš„å¥å£®æ€§ã€‚

æˆ‘ä»¬å°±ä»å…¨å±€å˜é‡ `window` å¼€å§‹ã€‚

`window` çš„åŸå‹å…³ç³»
--------------

æˆ‘ä»¬çŸ¥é“ ï¼Œwindow å’Œ Window éƒ½æ˜¯å¯ä»¥ç›´æ¥å¼•ç”¨çš„å…¨å±€å¯¹è±¡å±æ€§ï¼Œè€Œä¸”â€œä¸€å®šâ€æ»¡è¶³ _`window instanceof Window === true`_ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒä»¬çš„å±æ€§æè¿°ç¬¦ï¼š

    Reflect.getOwnPropertyDescriptor(globalThis, 'window')
    // {
    //     configurable: false
    //     enumerable: true
    //     get: Æ’Â window()
    //     set: undefined
    // }
    Reflect.getOwnPropertyDescriptor(globalThis, 'Window')
    // {
    //     configurable: true
    //     enumerable: false
    //     value: Æ’Â Window()
    //     writable: true
    // }
    

window æ²¡ä»€ä¹ˆäº‰è®®ï¼Œå®ƒä¸€å®šæ˜¯ä¸€ä¸ª**ä¸å¯é…ç½®**ã€**ä¸å¯æ›´æ”¹**çš„å±æ€§ï¼Œæ—¶åˆ»ä¿è¯å®ƒçš„å®‰å…¨ã€‚ä½†æ˜¯ Window å°±ä¸é‚£ä¹ˆä¸¥æ ¼äº†ï¼Œä¸ä½†æ˜¯å¯é…ç½®çš„ï¼Œè€Œä¸”å¯å†™ï¼Œå› æ­¤ä½ å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„â€œæ¶æ„â€ä»£ç ï¼š

    global.Window = function Window() {
        return window;
    };
    
    new Window(); // success
    
    window instanceof Window; // false
    

æ‰€ä»¥è¯´ **`Window æ˜¯å¯è¢«ç¯¡æ”¹çš„`**ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¢è®¨ window å¯¹è±¡çš„åŸå‹é“¾ï¼Œç”¨ `Reflect.getPrototypeOf`ï¼Œæˆ–è€…éæ ‡å‡†çš„ `__proto__`ï¼š

    const winProto = Reflect.getPrototypeOf(window); // window.__proto__
    

è§‚å¯Ÿä¸€ä¸ªå¯¹è±¡æœ‰å‡ ä¸ªè§’åº¦ï¼š**å±æ€§**ã€**å¯æ‰©å±•**ä»¥åŠ**åŸå‹**ã€‚å…ˆçœ‹ _winProto_ çš„è‡ªèº«å±æ€§ï¼š

    Reflect.ownKeys(winProto) // [Â "constructor",Â Symbol("Symbol.toStringTag")Â ]
    

å®ƒè‡³å°‘æœ‰ä¸¤ä¸ªå±æ€§ï¼š`constructor` å’Œ `Symbol.toStringTag`ï¼Œè¿™æ˜¯åˆç†çš„ï¼Œå›å¿†ä¸€ä¸‹åœ¨å‡½æ•°é‚£ä¸€èŠ‚çš„å†…å®¹ï¼Œå‡½æ•°åœ¨å®šä¹‰çš„æ—¶å€™ï¼Œå°±åº”è¯¥ä¸ºå…¶åˆ›å»ºä¸€ä¸ª `prototype` å±æ€§ï¼Œå€¼æ˜¯ä¸€ä¸ªåŒ…å« `constructor` å±æ€§çš„ç®€å•å¯¹è±¡ï¼š

    const fooProto = {};
    
    Objet.defineProperty(fooProto, 'constructor', {
        value: Foo,
        writable: true,
        enumerable: false,
        configurable: true
    });
    
    Objet.defineProperty(Foo, 'prototype', {
        value: fooProto,
        writable: true,
        enumerable: false,
        configurable: false
    });
    

æ‰€ä»¥ _winProto_ ä¸Šæœ‰ä¸€ä¸ª _constuctor_ æ˜¯å¿…ç„¶çš„ã€‚å†åŠ ä¸Š `Symbol.toStringTag` çš„æœ¬èº«èŒèƒ½å®šä½ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ° Window è¿™æ ·çš„ç»“æ„ï¼š

    class Window {
        constructor() {}
        get [Symbol.toStringTag]() {
            return 'Window';
        }
    }
    

ä½†æ˜¯ä»ç„¶å’Œå®é™…æœ‰å·®åˆ«ï¼Œä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿæˆ‘ä»¬æŠŠå±æ€§æè¿°ç¬¦æ‰“å°å‡ºæ¥ï¼š

    Reflect.getOwnPropertyDescriptor(winProto, Symbol.toStringTag)
    // {
    //     configurable: true,
    //     enumerable: false,
    //     value: "Window",
    //     writable: false,
    // }
    

å¯ä»¥çœ‹åˆ°å±æ€§ `[Symbol.toStringTag]` æ˜¯ä¸€ä¸ªæ•°æ®å±æ€§ï¼Œè€Œä¸æ˜¯å­˜å–å™¨å±æ€§ï¼Œæ‰€ä»¥ä¸èƒ½åƒä¸Šé¢é‚£æ ·ç”¨ _getter_ å®šä¹‰ï¼Œåªèƒ½è¿™æ ·ï¼š

    Reflect.defineProperty(Window.prototype, Symbol.toStringTag, {
        configurable: true,
        enumerable: false,
        value: "Window",
        writable: false,
    });
    

æ¥ä¸‹æ¥çœ‹ _winProto_ æ˜¯å¦å¯æ‰©å±•ï¼š

    Reflect.isExtensible(winProto) // true
    

å¯æ‰©å±•ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é¿å¼€ window æœ¬èº«ï¼Œè€Œå®šä¹‰å‡ºèƒ½åœ¨ window ä¸Šè¯»å†™çš„æ•°æ®ï¼š

    Reflect.defineProperty(Window.prototype, "YOUR_CUSTOM_DATA", {
        value: 99
    });
    
    window.YOUR_CUSTOM_DATA // 99
    

> ğŸ’¡ æˆ‘ç”µè„‘çš„ Chrome ä¸­ï¼Œwindow åŸå‹ä¸Šæ€»ä¼šè«ååœ°å‡ºç° PERSISTENT å’Œ TEMPORARY è¿™ä¸¤ä¸ª keyï¼Œå®ƒä»¬å°±å¯ä»¥ç”¨ _window.PERSISTENT_ å’Œ _window.TEMPORARY_ è®¿é—®ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é¡ºç€ prototype ç»§ç»­å‘ä¸Šâ€œçˆ¬â€ï¼š

    const winProtoProto = Reflect.getPrototypeOf(winProto);
    

Chrome ä¸Šæ‰“å°å‡ºæ¥çš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a46ad14e09bc4eac913474052d9697b9~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=525&h=52&s=17317&e=png&b=fefdfd)

æˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ª `WindowProperties` ç±»å‹çš„å¯¹è±¡ï¼Œä½†å®ƒå´æ²¡æœ‰ _constructor_ï¼Œæˆ‘ä»¬çŒœæµ‹å®ƒå¹¶éæ˜¯éšç€æŸä¸ªå‡½æ•°çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

    const windowProperties = {
        [Symbol.toStringTag]: "WindowProperties"
    };
    
    Reflect.setPrototypeOf(winProto, windowProperties);
    

ç»§ç»­å‘ä¸Šï¼š

    const winProtoProtoProto = Reflect.getPrototypeOf(winProtoProto);
    

æˆ‘ä»¬æ¥åˆ°äº†ä¸€ä¸ªå«åš `EventTarget` çš„å¯¹è±¡ï¼Œå¹¶ä¸”å‘ç°å’Œäº‹ä»¶ç›¸å…³çš„ APIï¼š`addEventListener`ã€`removeEventListener`ã€`dispatchEvent`ï¼ŒåŸæ¥éƒ½åœ¨è¿™é‡Œé¢ã€‚

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c24e0b9257bf45a28d0a3dda30a3cc69~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=2038&h=228&s=95383&e=png&b=ffffff)

EventTarget ä¹Ÿæ˜¯ä¸€ä¸ªå…¬å¼€çš„ APIï¼Œå¹¶éµå¾ª whatwg [è§„èŒƒ](https://dom.spec.whatwg.org/#interface-eventtarget "https://dom.spec.whatwg.org/#interface-eventtarget")ã€‚å¯ä»¥è¯´ï¼Œ**æµè§ˆå™¨ä¸­æ‰€æœ‰å®ç°äº†ç›¸å…³äº‹ä»¶æ¥å£çš„å¯¹è±¡ï¼ŒåŸå‹é“¾ä¸Šéƒ½èƒ½è¿½æº¯åˆ° EventTargetï¼Œé™¤äº† Window ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ Documentã€å„ç§ HTMLElementã€XMLHttpRequest ç­‰ç­‰**ã€‚

äº‹ä»¶æ´¾å‘æœºåˆ¶åœ¨å‰ç«¯ä¸­æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ç¼–ç¨‹èŒƒå¼ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯ **Pub-Sub**ã€‚é€šå¸¸ä¼šå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ¥å®ç°ï¼Œæ¯”å¦‚ _eventemitter3_ã€_mitt_ ç­‰ç­‰ã€‚ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œä¸ç”¨å¼•å…¥ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œç›´æ¥ç”¨åŸç”Ÿçš„ `EventTarget` å°±å¯ä»¥äº†ï¼Œè€Œä¸”ä¹Ÿé€‚ç”¨äº Node.js ç¯å¢ƒï¼š

    class MyEventBus extends EventTarget {}
    

å¦‚æœå«Œå…¶ API åå­—å†—å¤ªé•¿ï¼Œæƒ³æ¢æˆ onã€offã€emitï¼Œä¹Ÿæ˜“å¦‚åæŒï¼š

    class MyEventBus {
        #et = new EventTarget();
        
        on(...args) {
            this.#et.addEventListener(...args);
        }
        
        off(...args) {
            this.#et.removeEventListener(...args);
        }
        
        emit(...args) {
            this.#et.dispatchEvent(...args);
        }
    }
    

è¯è¯´å›æ¥ï¼Œè¿™æ ·çœ‹æ¥ï¼Œé‚£ä¸ª _winProtoProto_ï¼Œå³ _WindowProperties_ å¯¹è±¡ï¼Œåº”è¯¥å¯ä»¥æ˜¯ç”± `EventTarget` æ„é€ çš„ï¼š

    const windowProperties = new EventTarget();
    
    Reflect.defineProperty(windowProperties, Symbol.toStringTag, {
        configurable:Â true,
        enumerable:Â false,
        value:Â "WindowProperties",
        writable:Â false
    });
    

EventTarget å†å¾€ä¸Šå°±åˆ°é¡¶äº†ï¼Œå³ **EventTarget.prototype.\_\_proto\_\_ === Object.prototype**ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œwindow çš„åŸå‹é“¾ç»“æ„ï¼š

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6833a210e6b4e7da3ddbdf25259930c~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1444&h=2044&s=210833&e=png&b=ffffff)

å…¶å®å°±åªæœ‰ä¸¤å±‚æ¨¡å‹ï¼Œä¸€ä¸ªæ˜¯ Windowï¼Œä¸€ä¸ªæ˜¯ EventTargetã€‚æˆ‘ä»¬åˆšæ‰æ²¡æœ‰è¯•æ¢ _windowProperties_ å’Œ EventTarget çš„å¯æ‰©å±•æ€§ï¼Œå®ƒä»¬å…¶å®éƒ½æ˜¯å¯æ‰©å±•çš„ï¼Œå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œä½ å®Œå…¨å¯ä»¥åœ¨é‡Œé¢å¢åŠ æƒ³è¦çš„æ•°æ®ï¼Œå¯èƒ½æ¯”åœ¨ window å¯¹è±¡æœ¬èº«å®šä¹‰å±æ€§è¦å®‰å…¨å’Œâ€œé«˜çº§â€ã€‚

DOM èŠ‚ç‚¹çš„åŸå‹å…³ç³»
-----------

é™¤äº† window ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æœ€å¸¸æ‰“äº¤é“çš„å°±æ˜¯ DOM äº†ï¼Œå¦‚æœæŒ‰ç…§èŠ‚ç‚¹ï¼ˆNodeï¼‰çš„å®šä¹‰ç®—ï¼Œä¹ŸåŒ…æ‹¬ documentã€‚æˆ‘ä»¬æŒ‰ç…§ä¸Šé¢å¯¹ window çš„æ–¹æ³•ï¼Œä¸€è·¯å‘ä¸ŠæŠŠåŸå‹é“¾çš„æ¯ä¸€ç¯èŠ‚æ‰“å°å‡ºæ¥ï¼š

    const ele = document.createElement('form');
    console.log(ele.__proto__, Reflect.ownKeys(ele.__proto__));
    console.log(ele.__proto__.__proto__, Reflect.ownKeys(ele.__proto__.__proto__));
    console.log(ele.__proto__.__proto__.__proto__, Reflect.ownKeys(ele.__proto__.__proto__.__proto__));
    console.log(ele.__proto__.__proto__.__proto__.__proto__, Reflect.ownKeys(ele.__proto__.__proto__.__proto__.__proto__));
    console.log(ele.__proto__.__proto__.__proto__.__proto__.__proto__, Reflect.ownKeys(ele.__proto__.__proto__.__proto__.__proto__.__proto__));
    

æˆ‘æ˜¯ä»¥ <form> ä¸ºä¾‹ï¼Œæ‰€ä»¥å…ˆå¾—åˆ°çš„æ˜¯ `HTMLFormElement.prototype`ï¼Œè¿™ä¸Šé¢æœ‰å“ªäº›å±æ€§å‘¢ï¼Ÿ

    "acceptCharset"
    "action"
    "autocomplete"
    "enctype"
    "encoding"
    "method"
    "name"
    "noValidate"
    "target"
    "elements"
    "length"
    "checkValidity"
    "reportValidity"
    "requestSubmit"
    "reset"
    "submit"
    "rel"
    "relList"
    "constructor"
    Symbol(Symbol.toStringTag)
    Symbol(Symbol.iterator)
    

ä»¥ä¸Šå±æ€§éƒ½æ˜¯å¯é…ç½®çš„ï¼Œæ„å‘³ç€ä½ å¯ä»¥éšæ„â€œç¯¡æ”¹â€å®ƒä»¬çš„ä½œç”¨ã€‚å…¶ä¸­_action_ã€_enctype_ã€_method_ã€_target_ æ˜¯æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„å±æ€§ã€‚ä½†æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†é™Œç”Ÿçš„å±æ€§ï¼Œç‰¹åˆ«æ˜¯ `[Symbol(Symbol.iterator)]`ã€‚

ç›¸ä¿¡å¾ˆå¤šåŒå­¦éƒ½ä¸çŸ¥é“ <form> æ˜¯å¯éå†çš„ï¼Œä»¥å¦‚ä¸‹ä¸ºä¾‹ï¼š

    <form>
        <input type="text" name="foo" value="foo">
        <textarea name="bar" id="" cols="30" rows="10">bar</textarea>
        <input type="radio" name="baz">
        <input type="radio" name="baz" checked>
    </form>
    
    <script>
        const ele = document.getElementsByTagName('form')[0];
        for (const child of ele)
            console.log(child);
    </script>
    

åœ¨ Safari ä¸‹æ‰“å°çœ‹å¾—æ›´æ¸…æ™°ä¸€äº›ï¼š

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2806784d82fd45498dc58fdda2e92cb5~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=808&h=176&s=42283&e=png&b=fefdfd)

å› æ­¤ï¼Œ**`åœ¨ <form> ä¸Šéå†å¾—åˆ°çš„æ˜¯å…¶å†…éƒ¨çš„è¡¨å•å…ƒç´ `**ã€‚é™¤äº† inputã€textarea ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬ buttonã€filedsetã€objectã€outputã€selectã€‚

åœ¨ HTMLFormElement ä¹‹ä¸Šï¼Œæ˜¯ `HTMLElement`ï¼Œå®ƒçš„å±æ€§éå¸¸å¤šï¼š

    "constructor"
    "title"
    "lang"
    "translate"
    "dir"
    "hidden"
    "accessKey"
    "accessKeyLabel"
    "draggable"
    "spellcheck"
    "innerText"
    "inert"
    "outerText"
    "autocorrect"
    "webkitdropzone"
    "style"
    "attributeStyleMap"
    "onbeforecopy"
    "onbeforecut"
    "onbeforeinput"
    "onbeforepaste"
    "contentEditable"
    "enterKeyHint"
    "isContentEditable"
    "inputMode"
    "onabort"
    "onblur"
    "oncancel"
    "oncanplay"
    "oncanplaythrough"
    "onchange"
    "onclick"
    "onclose"
    "oncontextmenu"
    "oncopy"
    // æ­¤å¤„çœç•¥
    "onpointerover"
    "onpointerout"
    "onpointerenter"
    "onpointerleave"
    "onselectstart"
    "onselectionchange"
    "offsetParent"
    "offsetTop"
    "offsetLeft"
    "offsetWidth"
    "offsetHeight"
    "dataset"
    "nonce"
    "autofocus"
    "tabIndex"
    "click"
    "attachInternals"
    "focus"
    "blur"
    Symbol(Symbol.toStringTag)
    

ç”±äºæ‰€æœ‰ HTML å…ƒç´ éƒ½æ´¾ç”Ÿè‡ª `HTMLElement`ï¼Œå› æ­¤å®ƒå›Šæ‹¬äº†æ‰€æœ‰å…¬å…±å±æ€§ï¼Œæ¯”å¦‚ titleã€langã€dirã€styleã€tabIndexï¼Œä»¥åŠå¤§é‡çš„äº‹ä»¶å‡½æ•°ï¼Œä¸è¿‡æ˜¾ç„¶ï¼Œå¯¹äºç‰¹å®šçš„å…ƒç´ è€Œè¨€ï¼Œåªæœ‰éå¸¸æœ‰é™çš„äº‹ä»¶æ˜¯æœ‰æ„ä¹‰çš„ã€‚

HTMLElement ä¹‹ä¸Šæ˜¯ `Element`ã€‚å®ƒæ˜¯ [DOM è§„èŒƒ](https://dom.spec.whatwg.org/#interface-element "https://dom.spec.whatwg.org/#interface-element")çš„ä¸€éƒ¨åˆ†ã€‚è¿™é‡Œçš„ DOM æ˜¯å¹¿ä¹‰çš„ï¼ŒåŒ…å« XMLã€SVG ç­‰æ ‡ç­¾æ ¼å¼æ–‡æ¡£ï¼Œæ‰€ä»¥ HTMLElement æ´¾ç”Ÿè‡ª Elementã€‚å®ƒçš„å±æ€§æœ‰ï¼š

    "getAttributeNames"
    "getAttribute"
    "getAttributeNS"
    "toggleAttribute"
    "setAttribute"
    "setAttributeNS"
    "removeAttribute"
    "removeAttributeNS"
    "hasAttribute"
    "hasAttributeNS"
    "hasAttributes"
    "closest"
    "matches"
    "webkitMatchesSelector"
    "getElementsByTagName"
    "getElementsByTagNameNS"
    "getElementsByClassName"
    "insertAdjacentElement"
    "insertAdjacentText"
    "mozMatchesSelector"
    "setPointerCapture"
    "releasePointerCapture"
    "hasPointerCapture"
    "setCapture"
    "releaseCapture"
    "getAttributeNode"
    "setAttributeNode"
    "removeAttributeNode"
    "getAttributeNodeNS"
    "setAttributeNodeNS"
    "getClientRects"
    "getBoundingClientRect"
    "checkVisibility"
    "scrollIntoView"
    "scroll"
    "scrollTo"
    "scrollBy"
    "insertAdjacentHTML"
    "querySelector"
    "querySelectorAll"
    "attachShadow"
    "requestFullscreen"
    "mozRequestFullScreen"
    "requestPointerLock"
    "animate"
    "getAnimations"
    "before"
    "after"
    "replaceWith"
    "remove"
    "prepend"
    "append"
    "replaceChildren"
    "namespaceURI"
    "prefix"
    "localName"
    "tagName"
    "id"
    "className"
    "classList"
    "part"
    "attributes"
    "scrollTop"
    "scrollLeft"
    "scrollWidth"
    "scrollHeight"
    "clientTop"
    "clientLeft"
    "clientWidth"
    "clientHeight"
    "scrollTopMax"
    "scrollLeftMax"
    "innerHTML"
    "outerHTML"
    "shadowRoot"
    "assignedSlot"
    "slot"
    "onfullscreenchange"
    "onfullscreenerror"
    "previousElementSibling"
    "nextElementSibling"
    "children"
    "firstElementChild"
    "lastElementChild"
    "childElementCount"
    "constructor"
    Symbol("Symbol.unscopables")
    Symbol("Symbol.toStringTag")
    

è¿™é‡Œé¢æœ‰éå¸¸å¤šçš„å¸¸ç”¨ APIï¼Œæ¯”å¦‚ getAttribute/setAttributeã€getElementsByTagNameã€getElementsByClassNameã€getBoundingClientRectã€innerHTML/outerHTMLã€querySelector/querySelectorAllã€childrenã€scrollTopã€scrollLeftã€className ç­‰ç­‰ã€‚

æˆ‘è®¤ä¸ºå…¶å® HTMLElement å’Œ Element å¹¶æ²¡æœ‰è§£è€¦å¾—å¾ˆå½»åº•ï¼Œç†ç”±æ˜¯ï¼š

1.  innerHTMLã€outerHTMLã€insertAdjacentHTML å®šä¹‰åœ¨äº† Element è€Œä¸æ˜¯ HTMLElement ä¸Šï¼›
2.  getElementsByTagNameã€getElementsByClassName è¿”å›çš„æ˜¯ HTMLElement è€Œä¸æ˜¯ Element çš„é›†åˆï¼›
3.  onfullscreenchangeã€onfullscreenerror å®šä¹‰åœ¨äº† Element ä¸Šè€Œä¸æ˜¯ HTMLElement ä¸Šã€‚

æœ‰äº› APIï¼Œå¦‚ firstElementChildã€lastElementChildã€previousElementSiblingã€previousElementSiblingã€closest è¿”å›çš„æ˜¯ Elementï¼Œè¿™åœ¨ TypeScript å¯èƒ½äº§ç”Ÿä¸€äº›ä¸ä¾¿ï¼š

    const next = element.nextElementSibling;
    // next æ˜¯ Elementï¼Œä½† style å®šä¹‰åœ¨ HTMLElementä¸Šï¼Œè¿™é‡Œéœ€è¦å¼ºè½¬
    (next as HTMLElement)?.style // âŒ
    

`querySelectorAll` ä¸ `getElementsByTagName`ã€`getElementsByClassName` éƒ½æ˜¯æŸ¥è¯¢åä»£å…ƒç´ é›†åˆçš„ APIï¼Œä½†æ˜¯æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå³å‰è€…çš„ç»“æœæ˜¯ _static_ çš„ï¼Œåè€…æ˜¯ _live_ çš„ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿ

`querySelectorAll` çš„ç»“æœåœ¨æŸ¥è¯¢ç»“æŸæ—¶å°±å·²ç»å›ºå®šäº†ï¼Œä½†æ˜¯ `getElementsByTagName`ã€`getElementsByClassName` ä¹‹è¾ˆçš„ç»“æœå¹¶ä¸å›ºå®šï¼Œå¦‚æœæœ‰åŒ¹é…æ¡ä»¶çš„ DOM å¢å‡ï¼Œä¹Ÿä¼šååº”åˆ°å…¶ç»“æœä¸­ã€‚å› æ­¤ï¼Œæœ€å¥½ä¸è¦å¼‚æ­¥åœ°éå†å®ƒä»¬çš„ç»“æœï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¼šå‡ºç° undefined å¼‚å¸¸ã€‚

å…·ä½“æ¥è¯´ï¼Œ`getElementsByTagName`ã€`getElementsByClassName` è¿”å›ä¸€ä¸ªå«åš **`HTMLCollection`** çš„å¯¹è±¡ï¼Œå¯ä»¥å½“ä½œ_ç±»æ•°ç»„_ï¼Œä½†æ˜¯æœ‰æ›´å¤šçš„æ–¹æ³•å¯ç”¨ã€‚çŒœæƒ³å…¶å†…éƒ¨ä¸€å®šå­˜å‚¨äº†æŸ¥è¯¢æ¡ä»¶ï¼Œæ‰èƒ½å®ç°è¿™æ ·çš„åŠ¨æ€è·Ÿè¸ªèƒ½åŠ›ã€‚

è€Œ `querySelectorAll` è¿”å›çš„å…¶å®æ˜¯ `Node` çš„é›†åˆï¼Œä»€ä¹ˆæ˜¯ Node å‘¢ï¼Ÿå®ƒæ˜¯ Element çš„ä¸Šæ¸¸ï¼Œåœ¨[åŒä¸€ä»½è§„èŒƒ](https://dom.spec.whatwg.org/#interface-node "https://dom.spec.whatwg.org/#interface-node")ä¸­ã€‚

    "getRootNode"
    "hasChildNodes"
    "insertBefore"
    "appendChild"
    "replaceChild"
    "removeChild"
    "normalize"
    "cloneNode"
    "isSameNode"
    "isEqualNode"
    "compareDocumentPosition"
    "contains"
    "lookupPrefix"
    "lookupNamespaceURI"
    "isDefaultNamespace"
    "nodeType"
    "nodeName"
    "baseURI"
    "isConnected"
    "ownerDocument"
    "parentNode"
    "parentElement"
    "childNodes"
    "firstChild"
    "lastChild"
    "previousSibling"
    "nextSibling"
    "nodeValue"
    "textContent"
    "ELEMENT_NODE"
    "ATTRIBUTE_NODE"
    "TEXT_NODE"
    "CDATA_SECTION_NODE"
    "ENTITY_REFERENCE_NODE"
    "ENTITY_NODE"
    "PROCESSING_INSTRUCTION_NODE"
    "COMMENT_NODE"
    "DOCUMENT_NODE"
    "DOCUMENT_TYPE_NODE"
    "DOCUMENT_FRAGMENT_NODE"
    "NOTATION_NODE"
    "DOCUMENT_POSITION_DISCONNECTED"
    "DOCUMENT_POSITION_PRECEDING"
    "DOCUMENT_POSITION_FOLLOWING"
    "DOCUMENT_POSITION_CONTAINS"
    "DOCUMENT_POSITION_CONTAINED_BY"
    "DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC"
    "constructor"
    Symbol("Symbol.toStringTag")
    

Node çš„æ¦‚å¿µç›¸æ¯”äº Element åˆ™æ›´åŠ æŠ½è±¡ï¼Œé™¤äº†å…ƒç´ ä¹‹å¤–ï¼Œåƒæ³¨é‡Šï¼ˆCommentï¼‰ã€å±æ€§ï¼ˆAttributeï¼‰ã€ç‰‡æ®µï¼ˆFragmentï¼‰ã€æ–‡æœ¬ï¼ˆTextï¼‰ç­‰ç­‰éƒ½å±äº Node çš„ä¸€ç§ã€‚åœ¨å®ƒçš„ API ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯æ“ä½œå’Œæè¿°ç›¸äº’å…³ç³»çš„ insertBeforeã€appendChildã€replaceChildã€removeChildã€childNodesã€previousSiblingã€nextSiblingã€nodeValueã€nodeTypeã€textContentã€parentNode ç­‰ç­‰ã€‚

ç®—ä¸‹æ¥æˆ‘ä»¬å‘ç°æœ‰å¥½å‡ ä¸ª API çš„ç”¨æ³•æ˜¯å®¹æ˜“å¼•èµ·æ··æ·†çš„ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š

Node çš„å±æ€§

Elementæˆ–å…¶å®ƒçš„å±æ€§

å¯¹æ¯”

firstChild

firstElementChild

å‰è€…è¿”å› Nodeï¼Œåè€…è¿”å› Elementï¼ŒäºŒè€…å¯èƒ½ç›¸åŒå¯èƒ½ä¸åŒ

lastChild

lastElementChild

åŒä¸Š

previousSibling

previousElementSibling

åŒä¸Š

nextSibling

nextElementSibling

åŒä¸Š

parentNode

parentElement

åŒä¸Šï¼ŒäºŒè€…éƒ½å®šä¹‰åœ¨ Node ä¸Š

textContent

innerText

åè€…å®šä¹‰åœ¨ HTMLElement ä¸­ï¼Œå®ƒä»¬å–å€¼çš„å·®åˆ«åœ¨äºå‰è€…å°† HTML ä¸­æ‰€æœ‰ç©ºç™½ï¼ˆåŒ…æ‹¬æ¢è¡Œï¼‰éƒ½ä¿ç•™ï¼Œåè€…ä¼šåˆå¹¶ç©ºç™½ï¼Œé‡åˆ°å—çº§å…ƒç´ æ‰ä¼šå‡ºç°æ¢è¡Œï¼ˆ`\n`ï¼‰

childNodes

children

å‰è€…æ˜¯ static çš„ `NodeList`ï¼Œåè€…æ˜¯ live çš„ `HTMLCollection`

insertBefore

insert

å‰è€…çš„ä¸»è¯­æ˜¯çˆ¶èŠ‚ç‚¹ï¼Œåè€…çš„ä¸»è¯­æ˜¯è¦æ’å…¥è¿›å»çš„å…ƒç´ 

appendChild

append

åè€…å¯ä¸€æ¬¡æ€§æ’å…¥å¤šä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ”¯æŒå­—ç¬¦ä¸²å‚æ•°

replaceChildren

replaceWith

åŒä¸Š

å¯è§ï¼Œè™½ç„¶æˆ‘ä»¬èƒ½åœ¨ä¸€ä¸ª DOM å…ƒç´ ä¸Šè®¿é—®è¿™æ•°ç™¾ä¸ªå±æ€§ï¼Œä½†æ˜¯å®ƒä»¬å´å®šä¹‰åœ¨ä¸åŒçš„æ¨¡å‹ä¸Šã€‚

Node å†å¾€ä¸Šå°±æ˜¯ EventTarget äº†ã€‚æ‰€ä»¥å•æ‹¿ä¸€ä¸ª DOM å…ƒç´ æ¥è¯´ï¼Œå®ƒçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95358deb3cf746efa5bbdb60c8828ab0~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1844&h=1764&s=400625&e=png&b=fefcfc)

**`å¸¸ç”¨çš„ document ä¹Ÿæ˜¯ä¸€ç§ Node`**ã€‚ä¸è¿‡ document æœ¬èº«çš„å±æ€§å´å°‘å¾—å¯æ€œï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªæœ‰ `location` ä¸€ä¸ªï¼š

    Relfect.ownKeys(document) // ["location"]
    

æ²¡é”™ï¼Œ**`document å’Œ window éƒ½æœ‰ location å±æ€§ï¼Œå®ƒä»¬æ˜¯ç­‰ä»·çš„`**ï¼š

    document.location === window.location // true
    

location èƒ½è®¿é—®çš„å±æ€§åŸºæœ¬éƒ½åœ¨å…¶å¯¹è±¡è‡ªèº«ä¸Šï¼Œå…¶åŸå‹åŸºæœ¬æ˜¯ç©ºçš„ï¼š

    Reflect.getPrototypeOf(location)
    
    // {
    //     constructor: f Location
    //     Symbol(Symbol.toStringTag): "Location"
    // }
    

ä¸ `location` ä¸€èµ·å¸¸ç”¨çš„è¿˜æœ‰ `history` å’Œ `navigator`ï¼Œå®ƒä»¬ä¿©çš„ç‰¹ç‚¹æ˜¯å¯¹è±¡è‡ªèº«å¹¶æ²¡æœ‰å•ç‹¬å±æ€§ï¼Œå…¨éƒ¨ä½äºå…¶åŸå‹å¯¹è±¡ä¸Šï¼Œå¤§å®¶å¯ä»¥è¯•ä¸€è¯•ã€‚

å°ç»“
--

åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šèƒ½è®¿é—®åˆ°ä¸€ä¸ªå±æ€§åªæ˜¯è¡¨è±¡ï¼Œæˆ‘ä»¬è¿˜åº”çœ‹åˆ°å…¶èƒŒåçš„ç»“æ„å’ŒåŸç†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æ¢æŸ¥åŸå‹é“¾ï¼ŒçŸ¥é“äº† windowã€documentã€element ä¹‹é—´çš„å…³ç³»ï¼Œå®ƒä»¬éƒ½æ´¾ç”Ÿè‡ª EventTargetï¼Œå…¶ä¸­ document å’Œ element åˆç»§ç»­æ´¾ç”Ÿè‡ª Nodeã€‚element æ‹¥æœ‰å¤æ‚çš„åŸå‹å…³ç³»ï¼Œæ•°ç™¾ä¸ªå±æ€§åˆ†å±ä¸åŒå±‚çº§ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä¸­çš„ä¸åŒç¯èŠ‚ç€æ‰‹ï¼Œè½»æ¾æ”¹å˜å…ƒç´ çš„è¡Œä¸ºã€‚

ä»¥ä¸Šå†…å®¹æ˜¯ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆéƒ½åº”æŒæ¡çš„æœ€åŸºæœ¬çš„æµè§ˆå™¨ç¯å¢ƒçŸ¥è¯†ï¼Œå½“ç„¶ï¼Œè¿™äº›å†…å®¹ä¹Ÿåœ¨ä¸ºåä¸¤èŠ‚è¯¾åšé“ºå«ï¼Œä¸ºäº†å·©å›ºæœ¬å°å†Œæ‰€è®²çŸ¥è¯†ï¼Œæˆ‘è®¡åˆ’å¸¦å¤§å®¶å®ç°ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„æ¡ˆä¾‹â€”â€”åšä¸€ä¸ªæ²™ç›’ï¼ˆ_sandbox_ï¼‰ï¼Œå°½å¯èƒ½å›Šæ‹¬ JavaScript çš„æ‰€æœ‰é‡ç‚¹ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦ä»Šå¤©æ‰€è®²çš„æµè§ˆå™¨ç¯å¢ƒçŸ¥è¯†ï¼Œå¤§å®¶å‡†å¤‡å¥½å§ï½
è¿™ä¸€èŠ‚æˆ‘ä»¬å°†ä»¥å‰ç«¯å·¥ç¨‹ä¸­çš„3ç±»åœºæ™¯ä¸ºä¾‹ï¼Œä»‹ç»ç”¨è‡ªåŠ¨åŒ–å·¥å…·ä¼˜åŒ–å¼€å‘ä½“éªŒï¼Œæé«˜å·¥ä½œæ•ˆç‡çš„è§£å†³æ–¹æ¡ˆã€‚

1\. **è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥**
---------------

ç¬¬ä¸€ç±»åº”ç”¨è‡ªåŠ¨åŒ–åœºæ™¯æ˜¯å¯¹ä»£ç çš„è¯­æ³•é”™è¯¯ã€ä»£ç é£æ ¼è¿›è¡Œæäº¤å‰è‡ªåŠ¨åŒ–æ£€æŸ¥ã€‚

é¦–å…ˆæˆ‘ä»¬äº†è§£ä¸€äº›å‰ç«¯å·¥ç¨‹å¸¸ç”¨çš„ä»£ç æ£€æŸ¥å·¥å…·ã€‚

### 1\. **ESLint**

ESLintæ˜¯å‰ç«¯é¢†åŸŸæœ€æµè¡Œçš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œæœ€å¸¸è§çš„ç”¨é€”æ˜¯å¸®åŠ©å¼€å‘è€…åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œå®æ—¶æ£€æŸ¥è¯­æ³•é”™è¯¯ï¼Œæ­¤å¤–è¿˜æœ‰æä¾›æ’ä»¶ç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰ä»£ç æ£€æŸ¥è§„åˆ™ï¼Œå…·æœ‰å¾ˆå¼ºçš„æ‹“å±•æ€§ã€‚

#### **å¸¸ç”¨é…ç½®ç®€ä»‹**

1.  `rules`è§„åˆ™ï¼šç”¨äºé…ç½®ä»£ç çš„æ ¡éªŒè§„åˆ™ï¼Œä»¥åŠä¸ç¬¦åˆè§„åˆ™æ—¶çš„å¤„ç†æ–¹å¼ï¼ˆä¾‹å¦‚æŠ›å‡ºErroræˆ–Warningï¼‰ï¼Œæ˜¯ESLintçš„æ ¸å¿ƒé…ç½®ã€‚

    // .eslintrc.js
    rules: {
        'arrow-body-style': 0,        // å…³é—­ï¼Œç­‰äº "off"
        'no-shadow': 1,               // ä»…è­¦å‘Šï¼Œç­‰äº "warn"
        'no-use-before-define': 2,    // æŠ¥é”™ï¼Œç­‰äº "error"
    }
    

2.  `plugins`æ’ä»¶ï¼šç”¨äºæš´éœ²é¢å¤–çš„è§„åˆ™ï¼ˆ`rules`ï¼‰å’Œå…¨å±€é…ç½®ã€‚
3.  `parser`&& `parserOptions`ï¼šæŒ‡å®šæƒ³è¦æ”¯æŒçš„è¯­è¨€ç±»å‹åŠç»†èŠ‚é…ç½®ï¼ˆä¾‹å¦‚æ˜¯å¦æ”¯æŒJSXã€JSè¯­æ³•ç‰ˆæœ¬ï¼‰ã€‚
4.  `extends`ï¼šæŒ‡å®šç»§æ‰¿å…¶ä»–é…ç½®æ–‡ä»¶ã€‚
5.  `overrides`ï¼šæŒ‡å®šåªé’ˆå¯¹äºéƒ¨åˆ†æ–‡ä»¶çš„è¦†ç›–è§„åˆ™ï¼Œä¾‹å¦‚å¯¹.vueæ–‡ä»¶å…³é—­éƒ¨åˆ†è§„åˆ™ï¼š

    module.exports = {
      // ...
      overrides: [
        {
          files: ['**/*.+(vue)'],
          rules: {
             'no-use-before-define': 0,
          },
        },
      ],
    };
    

6.  `env`ï¼šç”¨äºæŒ‡å®šé¡¹ç›®è¿è¡Œçš„å…¨å±€ç¯å¢ƒå’Œç›¸å…³çš„è¯­æ³•è§„åˆ™ï¼Œä¾‹å¦‚æŒ‡å®šå½“å‰ä»£ç è¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­`env: { browser: true},`ï¼Œä¹‹åä½¿ç”¨`window`å…¨å±€å˜é‡å°±ä¼šè¢«ESLint
7.  `globals`ï¼šæŒ‡å®šå…¨å±€å˜é‡åŠå…¶æ˜¯å¦å¯è¯»å†™çŠ¶æ€ï¼Œä¾‹å¦‚ï¼š

    {
        "globals": {
            "var1": "writable",
            "var2": "readonly",
            "Promise": "off"
        }
    }
    

8.  `ignorePatterns`: æŒ‡å®šå¿½ç•¥ã€ä¸æ£€æŸ¥çš„æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼Œä¾‹å¦‚`ignorePatterns: ['dist', "**/vendor/*.js"],`
    

#### **ä½¿ç”¨æ–¹å¼ç®€ä»‹**

åœ¨é¡¹ç›®æ ¹ç›®å½•å¢åŠ é»˜è®¤çš„é…ç½®æ–‡ä»¶`eslint.config.js`æˆ–`.eslintrc.js`åï¼Œå°±å¯ä»¥ç”¨å‘½ä»¤è¡Œè°ƒç”¨ESLintå¯¹é¡¹ç›®ä¸­çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥äº†ï¼Œæ¨èé…ç½®ä¸º`lint`å‘½ä»¤ï¼š

    "scripts": {
        "lint": "eslint . --ext .js,.jsx,.ts,.tsx",
    }
    

æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºä»£ç ç¼–è¾‘å™¨é…ç½®ä¿å­˜åï¼Œè‡ªåŠ¨è¿è¡ŒESLintã€‚

ä¾‹å¦‚ä¸ºVSCodeé…ç½®ï¼Œæ–‡ä»¶ä¿å­˜åï¼Œè‡ªåŠ¨è¿è¡ŒESLintï¼Œå¹¶è‡ªåŠ¨ä¿®å¤å¯è¢«ä¿®å¤çš„æŠ¥é”™ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹éƒ¨åˆ†å³å¯å®ç°ï¼š

     # VSCode settings.json
     "editor.codeActionsOnSave": { "source.fixAll.eslint": true }
    

#### **å®ç°è‡ªå®šä¹‰ESLintè¾“å‡ºæ ¼å¼**

ESLint çš„ [Custom Formatter](https://eslint.org/docs/latest/developer-guide/working-with-custom-formatters "https://eslint.org/docs/latest/developer-guide/working-with-custom-formatters") æ˜¯å®è·µä¸­éå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œå¯ä»¥å®ç°è¿‡æ»¤éƒ¨åˆ†è§„åˆ™å’Œæ–‡ä»¶çš„è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ã€‚

åœ¨å®è·µä¸­ä¸ºé¡¹ç›®å¢åŠ ESLintæ—¶ï¼Œé¡¹ç›®çš„ç°å­˜æŠ¥é”™è¾ƒå¤šï¼ŒæœŸæœ›æŒ‰è§„åˆ™åˆ†ç±»ï¼Œå†ä¾æ¬¡ä¿®å¤æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ¢³ç†åˆ†ç±»æŠ¥é”™åŠæ¥æºï¼Œè§£å†³åå¤ç¼–è¾‘é…ç½®æ–‡ä»¶æˆ–ä½¿ç”¨å¤æ‚å‘½ä»¤è¡Œçš„ç—›ç‚¹ã€‚

ç¤ºä¾‹ä»£ç ï¼š

    // ./eslint-file-path-formatter.js
    const fs = require('fs');
    function containRules(result, targetRuleId) {
      if (!result || !targetRuleId) {
        return false;
      }
      return result.messages.some((cur) => {
        // console.log(`cur?.ruleId = ${cur?.ruleId}`);
        if (cur?.ruleId?.includes(targetRuleId)) {
          return true;
        }
      });
    }
    
    const targetRules = 'prop-types'
    
    module.exports = function (results, context) {
      const summary = [];
      results.forEach((cur) => {
        if (containRules(cur, targetRules)) {
          summary.push(`'${cur.filePath}',`);
        }
      });
      
      // fs.writeFileSync('eslint-error-files.txt', summary.join('\n'));
      // return 'Done Write';
      return summary.join('\n');
    };
    

è¿™æ®µä»£ç ä¸­æˆ‘ä»¬é€šè¿‡æŒ‡å®š`targetRules`å˜é‡ï¼Œè¿‡æ»¤å‡ºäº†éƒ¨åˆ†ä¿¡æ¯åŒ…å«`'prop-types'`çš„ESLintæŠ¥é”™ï¼Œå¸®æˆ‘ä»¬ä¸“æ³¨äºä¿®å¤è¯¥è§„åˆ™çš„æŠ¥é”™ã€‚

ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ä½¿ç”¨`eslint`çš„`-f`é€‰é¡¹å³å¯ï¼š

    eslint . -f ./eslint-file-path-formatter.js 
    

### 2\. **Prettier**

Prettier æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œè‡´åŠ›äºè®©å‰ç«¯é¡¹ç›®ä¸­ä¸åŒå¼€å‘è€…çš„ä»£ç ä¿æŒä¸€è‡´çš„**ä»£ç é£æ ¼**ã€‚æ”¯æŒå®šåˆ¶åŒ–é…ç½®ï¼Œå¯ä»¥æ–¹ä¾¿åœ°é›†æˆåˆ°ESLintæˆ–ä»£ç ç¼–è¾‘å™¨ä¸­ã€‚

#### **å¸¸ç”¨é…ç½®ç®€ä»‹**

    {
      "printWidth": 80,  // å•è¡Œä»£ç çš„æœ€å¤§å®½åº¦
      "tabWidth": 2,     // ç¼©è¿›ä½¿ç”¨çš„ç©ºæ ¼æ•°
      "useTabs": false,  // ä½¿ç”¨ç©ºæ ¼è€Œä¸æ˜¯åˆ¶è¡¨ç¬¦è¿›è¡Œç¼©è¿›
      "semi": true,      // åœ¨è¯­å¥æœ«å°¾æ·»åŠ åˆ†å·
      "singleQuote": true,     // ä½¿ç”¨å•å¼•å·è€Œä¸æ˜¯åŒå¼•å·
      "trailingComma": "es5",  // åœ¨å¤šè¡Œå¯¹è±¡æˆ–æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ åæ·»åŠ é€—å·
    }
    

### 3\. **Editor Config**

EditorConfig ä¹Ÿæ˜¯ç”¨äºå®šä¹‰**ä»£ç é£æ ¼**çš„å·¥å…·ï¼Œç‰¹ç‚¹æ˜¯ï¼š

1.  è·¨ç¼–è¾‘å™¨åŸç”Ÿæ”¯æŒï¼š[VSCodeã€Webstormç­‰ä¼—å¤šä¸»æµç¼–è¾‘å™¨éƒ½åŸç”Ÿæ”¯æŒ](https://editorconfig.org/#:~:text=No%20Plugin%20Necessary-,These%20editors,-come%20bundled%20with "https://editorconfig.org/#:~:text=No%20Plugin%20Necessary-,These%20editors,-come%20bundled%20with")ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…æ’ä»¶ã€‚
2.  ç¼–å†™**æ—¶**ç”Ÿæ•ˆï¼šå’ŒPrettieråœ¨ä»£ç ç¼–å†™**å**ï¼Œé‡æ–°æ ¼å¼åŒ–ä»£ç ä¸åŒï¼ŒEditorConfig è‡´åŠ›äºåœ¨ä»£ç ç¼–å†™**æ—¶**å°±è®©å¼€å‘è€…ä¿æŒä¸€è‡´çš„æ ¼å¼ã€‚ä½¿ç”¨EditorConfigæ—¶ï¼Œç”¨ç¼–è¾‘å™¨ç¼–å†™çš„ä»£ç é»˜è®¤å°±ä¼šæŒ‰é…ç½®è§„åˆ™ç”Ÿæˆï¼Œä¾‹å¦‚è®¾ç½®ç¼©è¿›ç©ºæ ¼æ•°ä¸º2ä¸ªç©ºæ ¼ï¼Œæ•²ä¸‹å›è½¦æ¢è¡Œåï¼Œç¼–è¾‘å™¨ä¼šé»˜è®¤ç”Ÿæˆ2ä¸ªç©ºæ ¼ç¼©è¿›çš„æ–°ä¸€è¡Œã€‚

å®ƒé€šè¿‡ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–‡ä»¶åä¸º `.editorconfig` çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ä¸åŒçš„ç¼–è¾‘å™¨ä¸­è‡ªåŠ¨åº”ç”¨ä¸€è‡´çš„ä»£ç é£æ ¼è§„åˆ™ã€‚

#### **å¸¸ç”¨é…ç½®ç®€ä»‹**

1.  `root`: æŒ‡å®šæ˜¯å¦åº”å°†å½“å‰é…ç½®æ–‡ä»¶è§†ä¸ºé¡¶çº§é…ç½®æ–‡ä»¶ã€‚å¦‚æœè®¾ç½®ä¸º `true`ï¼Œåˆ™è¯¥æ–‡ä»¶æ˜¯é¡¶çº§é…ç½®æ–‡ä»¶ï¼Œä¸ä¼šç»§æ‰¿å…¶ä»–é…ç½®æ–‡ä»¶ã€‚
2.  `indent_style`: æŒ‡å®šç¼©è¿›çš„æ ·å¼ã€‚å¯ä»¥æ˜¯ `tab`ï¼ˆåˆ¶è¡¨ç¬¦ï¼‰æˆ– `space`ï¼ˆç©ºæ ¼ï¼‰ã€‚
3.  `indent_size` : æŒ‡å®šç¼©è¿›çš„å¤§å°ã€‚å¯¹äº `indent_style` ä¸º `space` çš„æƒ…å†µï¼Œè¡¨ç¤ºç©ºæ ¼çš„æ•°é‡ã€‚å¯¹äº `indent_style` ä¸º `tab` çš„æƒ…å†µï¼Œè¯¥é¡¹ä¼šè¢«å¿½ç•¥ã€‚
4.  `end_of_line`: æŒ‡å®šæ¢è¡Œç¬¦çš„æ ·å¼ã€‚å¯ä»¥æ˜¯ `lf`ï¼ˆä»…æ¢è¡Œç¬¦ï¼‰ï¼Œ`cr`ï¼ˆä»…å›è½¦ç¬¦ï¼‰æˆ– `crlf`ï¼ˆå›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ï¼‰ã€‚

> ä½¿ç”¨Windowsç³»ç»Ÿè¿›è¡ŒGit addæ—¶ï¼Œç»å¸¸è§åˆ°çš„`LF && CRLF`æç¤ºï¼š`warning: in the working copy of 'README.md', LF will be replaced by CRLF the next time Git touches it`ã€‚å°±å¯ä»¥ç”¨`end_of_line`è¿™é¡¹é…ç½®é¿å…æç¤ºåå¤å‡ºç°ã€‚

5.  `insert_final_newline`: æŒ‡å®šæ˜¯å¦åœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ä¸€ä¸ªç©ºè¡Œã€‚å¯ä»¥æ˜¯ `true`ï¼ˆæ’å…¥ï¼‰æˆ– `false`ï¼ˆä¸æ’å…¥ï¼‰ã€‚
    
6.  `max_line_length`: æŒ‡å®šè¡Œçš„æœ€å¤§é•¿åº¦é™åˆ¶ã€‚è¶…è¿‡è¯¥é™åˆ¶çš„è¡Œå°†è¢«è§†ä¸ºè¿è§„ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ã€‚
    

`.editorconfig`é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š

    # EditorConfig is awesome: https://EditorConfig.org
    root = true
    
    # Unix-style newlines with a newline ending every file
    [*]
    end_of_line = lf
    insert_final_newline = true
    
    # Matches multiple files with brace expansion notation
    # Set default charset
    [*.{js,py}]
    charset = utf-8
    indent_style = space
    
    # For .js file, use 2 space indentation
    [*.js]
    indent_size = 2
    
    # For .py file, use 4 space indentation
    [*.py]
    indent_size = 4
    

### 4\. **Stylelint**

Stylelint æ˜¯ç”¨äºæ£€æµ‹ CSS ä»£ç ä¸­é”™è¯¯å’Œä¸è§„èŒƒä»£ç çš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€å¥—å¯é…ç½®çš„è§„åˆ™ï¼Œé…ç½®æ–‡ä»¶ä¸º `.stylelintrc` æˆ– `stylelint.config.js`ã€‚

#### **å¸¸ç”¨é…ç½®ç®€ä»‹**

1.  `extends`: æŒ‡å®šç»§æ‰¿çš„é…ç½®ï¼Œå¯ä»¥æ‰©å±•é¢„å®šä¹‰çš„é…ç½®ï¼Œä¾‹å¦‚ `stylelint-config-standard`ã€`stylelint-config-recommended`ï¼Œæˆ–è€…æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚
    
2.  `ignoreFiles`: æŒ‡å®šè¦å¿½ç•¥çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œå¯ä»¥æ˜¯å¤šä¸ªç”¨é€—å·åˆ†éš” Glob æ¨¡å¼å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„ã€‚ä¾‹å¦‚`ignoreFiles": ["**/*.js"]`ã€‚
    
3.  `rules`: æŒ‡å®šè§„åˆ™çš„é…ç½®ï¼Œå¯ä»¥å¯¹æ¯ä¸€æ¡è§„åˆ™é…ç½®æ˜¯å¦å¯ç”¨ç­‰ç»†èŠ‚ã€‚
    
4.  `plugins`: æŒ‡å®šè¦ä½¿ç”¨çš„ Stylelint æ’ä»¶ï¼Œæ‰©å±• Stylelint çš„åŠŸèƒ½ï¼Œæä¾›é¢å¤–çš„è§„åˆ™æˆ–åŠŸèƒ½ã€‚
    

### 5\. **Commitlint**

CommitLint æ˜¯ä¸€ä¸ªç”¨äºè§„èŒƒGitæäº¤æ¶ˆæ¯æ ¼å¼çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åœ¨Gitæäº¤å‰å¯¹æäº¤æ—¶é™„å¸¦çš„æ¶ˆæ¯è¿›è¡Œæ£€æŸ¥ï¼Œç¡®ä¿Gitæ¶ˆæ¯éƒ½ç¬¦åˆé¢„å®šä¹‰çš„æ ¼å¼ï¼Œå¸®åŠ©å›¢é˜Ÿä¿æŒä¸€è‡´çš„æäº¤æ¶ˆæ¯é£æ ¼ã€‚

æ¶ˆæ¯æ ¼å¼ä¸€èˆ¬çº¦å®šä¸ºï¼š`ç±»å‹(å½±å“èŒƒå›´?): ä¸»é¢˜`ï¼Œä¾‹å¦‚ï¼š

*   feat(ci): ä½¿ç”¨ESBuildåŠ é€ŸCIæ„å»º
*   fix(home): ä¿®å¤é¦–é¡µæŒ‰é’®æ ·å¼é”™ä¹±
*   chore: æ¸…ç†å†—ä½™ä»£ç 

å¦‚æœGit commit æäº¤çš„æ¶ˆæ¯ä¸ç¬¦åˆCommitLinté…ç½®çš„è§„åˆ™ï¼Œå°±ä¼šè¢«æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé˜»æ­¢æœ¬æ¬¡æäº¤ã€‚

CommitLint çš„ç‹¬ç«‹é…ç½®æ–‡ä»¶ä¸º `.commitlintrc` æˆ– `commitlint.config.js`ã€‚

#### **å¸¸ç”¨é…ç½®ç®€ä»‹**

1.  `extends`: æŒ‡å®šç»§æ‰¿çš„é…ç½®ï¼Œå¯ä»¥é€šè¿‡é…ç½®`{extends: ['@commitlint/config-conventional']}"`ä½¿ç”¨é¢„å®šä¹‰çš„ä¸€å¥—é…ç½® `@commitlint/config-conventional`ï¼Œä¹Ÿå¯ä»¥é¢å¤–æŒ‡å®šè‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚
2.  `rules`: æŒ‡å®šå…·ä½“æ¯ä¸€æ¡è§„åˆ™çš„é…ç½®ï¼Œå¼€å¯æˆ–å…³é—­ï¼Œä»¥åŠã€‚
3.  `prompt`: æŒ‡å®šè¾…åŠ©æäº¤æ¶ˆæ¯çš„å‘½ä»¤è¡Œé…ç½®ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ä»¥äº¤äº’å¼å‘½ä»¤è¡Œçš„å½¢å¼ç”Ÿæˆç¬¦åˆè§„åˆ™çš„Commitæ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b400f1b477124db4bce33bdae6133293~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1650&h=258&s=53572&e=png&b=282c34)

ä¸Šè¿°ä»‹ç»çš„å„ç±»å·¥å…·å¾€å¾€éœ€è¦æ‰‹åŠ¨è¿è¡Œæ‰èƒ½å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œåœ¨å®è·µä¸­å®¹æ˜“é—æ¼ï¼Œæ‰€ä»¥æœ€å¥½çš„åšæ³•æ˜¯ä¸ºè¿™äº›æ£€æŸ¥å·¥å…·é…ç½®**è‡ªåŠ¨åŒ–è¿è¡Œ**çš„é€»è¾‘ã€‚

### **ç¤ºä¾‹ï¼šä¸ºå‰ç«¯é¡¹ç›®å¢åŠ Gitæäº¤å‰ç»Ÿä¸€æ£€æŸ¥**

å¯¹ä»£ç è¿›è¡Œç»Ÿä¸€æ£€æŸ¥è¿™ä»¶äº‹ï¼Œè¿‡æ—©æ£€æŸ¥ï¼ˆä¾‹å¦‚æ¯ç¼–å†™ä¸€è¡Œä»£ç å°±æ£€æŸ¥ä¸€æ¬¡ï¼‰ä¼šæ‰“æ‰°å¼€å‘ä½“éªŒï¼Œå¤ªæ™šæ£€æŸ¥ï¼ˆä¾‹å¦‚ä»£ç åˆå…¥ä¸»åˆ†æ”¯æ—¶ï¼‰åˆå®¹æ˜“å¯¼è‡´é”™è¯¯ç§¯ç´¯å¤ªå¤šï¼Œéš¾ä»¥ä¿®å¤ã€‚

æ‰€ä»¥æœ€å¥½æ—¶æœºå°±æ˜¯åœ¨å¼€å‘è€…æ‰§è¡Œ`git commit`ä»£ç æäº¤æ—¶ï¼Œä¸šç•Œä¹Ÿæœ‰`husky`å’Œ`lint-staged`æˆç†Ÿçš„å·¥å…·å¸®åŠ©æˆ‘ä»¬å®ç°è¿™ä¸€ç›®æ ‡ã€‚

ä¸‹é¢æˆ‘ä»¬å°±æ¼”ç¤ºä¸€ä¸‹æ¥å…¥`husky`å’Œ`lint-staged`ï¼Œå»ºç«‹Gitæäº¤å‰ç»Ÿä¸€æ£€æŸ¥çš„å®ç°æ–¹å¼ã€‚

#### 1\. **å®‰è£…é…ç½®** **`lint-staged`**

`lint-staged`æ˜¯ä¸“ç”¨äºè¿‡æ»¤å‡ºå¤„äºGitæš‚å­˜åŒºï¼ˆgit add åï¼ŒçŠ¶æ€ä¸º`staged`ï¼‰çš„æ–‡ä»¶åˆ—è¡¨å¹¶æ‰§è¡Œå‘½ä»¤çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…å¯¹é¡¹ç›®æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå…¨é‡ä»£ç æ£€æŸ¥ä¿®å¤ï¼Œå¯¼è‡´æ£€æŸ¥è€—æ—¶å¤ªé•¿ã€‚

é¦–å…ˆå½“ç„¶è¿˜æ˜¯å®‰è£…å·¥å…·NPMåŒ…ï¼š

    npm install lint-staged --save-dev
    

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥é…ç½®å¹¶ä½¿ç”¨`lint-staged`ï¼Œå®ç°åªå¯¹ä¿®æ”¹è¿‡ã€å¹¶ä¸”è¢«`git add`æ·»åŠ åˆ°Gitæš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡ŒESLintæ£€æŸ¥å’ŒPrettieræ ·å¼ä¿®å¤ã€‚

é…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨package.jsonä¸­æ·»åŠ keyä¸º`lint-staged`çš„å¯¹è±¡å°±å¯ä½œä¸ºé…ç½®ç”Ÿæ•ˆï¼Œæ ¼å¼æ˜¯

*   `"ç›®æ ‡æ–‡ä»¶ Glob æ¨¡å¼å­—ç¬¦ä¸²": "æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤"`ï¼Œä¾‹å¦‚ï¼š

    {
      // å…¶ä»– package.json å†…å®¹
      "lint-staged": {
        "*.js": "eslint --fix"
      }
    }
    

å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æš‚å­˜åŒºçš„æ‰€æœ‰`.js, .ts, .tsx, .jsx`æ ¼å¼æ–‡ä»¶è¿›è¡ŒESLint å’Œ Prettier 2é¡¹æ£€æŸ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„é…ç½®å¦‚ä¸‹ï¼š

    {
      "lint-staged": {
        "*.{j,t}{s,sx}": [
          "eslint --fix",
          "prettier --write"
        ]
      },
    }
    

ä½†ä»…æœ‰`lint-staged`ï¼Œè¿˜ä¸èƒ½å®ç°åœ¨git commitå‰æäº¤è¿è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨`husky`ã€‚

#### 2\. **å®‰è£…é…ç½®** **`husky`**

`husky`æ˜¯ä¸€ä¸ªæ”¯æŒå¤šå¹³å°çš„Git hookå·¥å…·ï¼Œå¯ä»¥åœ¨commitã€pushç­‰Gitäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰§è¡Œæˆ‘ä»¬æŒ‡å®šçš„å‘½ä»¤ã€‚

é¦–å…ˆè®©æˆ‘ä»¬å®‰è£…å¹¶åˆå§‹åŒ–ï¼Œåªéœ€è¦1è¡Œå‘½ä»¤ï¼š

    npx husky-init && npm install
    

å°±ä¼šå¸®æˆ‘ä»¬é…ç½®å¥½`husky`ï¼Œå…·ä½“æ¥è¯´è¿™è¡Œå‘½ä»¤åšäº†3ä»¶äº‹ï¼š

1.  åœ¨`package.json`ä¸­æ·»åŠ äº†1ä¸ª`scripts`å‘½ä»¤ï¼š`"prepare": "husky install"`ï¼Œè¿™ä¸ª`prepare`å‘½ä»¤æ˜¯package.jsonè‡ªå¸¦çš„\*\*[ç”Ÿå‘½å‘¨æœŸå‘½ä»¤](https://docs.npmjs.com/cli/v9/using-npm/scripts#life-cycle-scripts "https://docs.npmjs.com/cli/v9/using-npm/scripts#life-cycle-scripts")\*\*ï¼Œä¼šåœ¨`npm install`ä¹‹å‰è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œå¸®åŠ©æˆ‘ä»¬æ–°åŠ å…¥é¡¹ç›®å¼€å‘çš„åŒäº‹æ‰§è¡Œ`husky install`å®‰è£…å¥½`husky`ã€‚
2.  æ–°å»ºäº†ä¸€ä¸ªå®ä¾‹é…ç½®æ–‡ä»¶ `./husky/pre-commit` ï¼šåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä»¥ç±»ä¼¼shellè„šæœ¬çš„è¯­æ³•å£°æ˜æƒ³è¦åœ¨`git commit`è¿è¡Œå‰æ‰§è¡Œçš„å‘½ä»¤ã€‚

å¯¹äºæˆ‘ä»¬çš„å‰ç«¯é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æŠŠé»˜è®¤çš„`npm test`æ”¹ä¸º`npx lint-staged`ï¼Œå£°æ˜æˆ‘ä»¬å¸Œæœ›åœ¨git commitæäº¤å‰ï¼Œè¿è¡Œ`lint-staged`ï¼Œæ ¹æ®å…¶é…ç½®è°ƒç”¨å„ç±»å·¥å…·ï¼Œæ£€æŸ¥å¤„äºGitæš‚å­˜åŒºçš„æ–‡ä»¶ã€‚

`./husky/pre-commit`æ–‡ä»¶ç¤ºä¾‹ï¼š

    #!/usr/bin/env sh
    . "$(dirname -- "$0")/_/husky.sh"
    
    npx lint-staged
    

#### 3\. **éªŒè¯Gitæäº¤å‰æ£€æŸ¥åŠŸèƒ½**

æœ‰äº†ä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®æºç ä¸­ç¼–å†™ä»£ç åï¼Œè¿è¡Œ`git commit`æ—¶ï¼Œå°±ä¼šè¿è¡Œæˆ‘ä»¬åœ¨`lint-staged`é…ç½®ä¸­æŒ‡å®š`eslint --fix`å’Œ`prettier --write`å‘½ä»¤ï¼Œå¯¹æ–°å¢çš„ä»£ç è¿›è¡Œç»Ÿä¸€çš„è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼Œå¦‚æœæœ‰è¯­æ³•é”™è¯¯æˆ–ä»£ç é£æ ¼é—®é¢˜è¢«æ£€æµ‹åˆ°ï¼Œæäº¤å°±ä¼šè¢«ä¸­æ–­ï¼Œä»è€Œé¿å…å¼‚å¸¸ä»£ç è¢«åˆå…¥ä¸»åˆ†æ”¯ï¼Œç”šè‡³éƒ¨ç½²åˆ°çº¿ä¸Šï¼Œæå‰æš´éœ²é—®é¢˜ï¼Œä¼˜åŒ–å¼€å‘ä½“éªŒã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5bfdd6d7699f464d95ca1ff27faac2e5~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1237&h=943&s=137899&e=png&b=1a1a1a)

> æ³¨ï¼šç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡`--no-verify` å‚æ•°ï¼Œä¸´æ—¶è·³è¿‡`husky`çš„æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š`git commit -m "feat: ç´§æ€¥ä¸Šçº¿" --no-verify`

2\. **ä¸€é”™ä¸å†é”™-ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•é¿å…åŠŸèƒ½è¡°é€€**
--------------------------

ç¬”è€…å‰äº›å¹´ä¸€ç›´ä¸ç†è§£è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Œæ„Ÿè§‰è‡ªå·±æ—¥å¸¸å¼€å‘å·¥ä½œå·²ç»ä¸å ªé‡è´Ÿï¼Œå“ªé‡Œè¿˜æœ‰æ—¶é—´å†æŠ•å…¥åˆ°ç¼–å†™æµ‹è¯•ç”¨ä¾‹ä¸­å‘¢ï¼Ÿ

è€Œä¸”å†™è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç›®çš„ï¼Œä¹Ÿåªæ˜¯éªŒè¯æˆ‘å·²ç»å®ç°çš„åŠŸèƒ½ï¼Œæ—¢ç„¶å·²ç»å®ç°äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆæµ‹è¯•çš„å¿…è¦å‘¢ï¼Ÿ

è‡ªåŠ¨åŒ–æµ‹è¯•éš¾é“ä¸æ˜¯åœ¨æµªè´¹æ—¶é—´å—ï¼Ÿ

è¿™ç§æ€æƒ³çš„è½¬æŠ˜ç‚¹æ˜¯ç¬”è€…å¼€å‘å¼€æºåº“[vue-template-babel-compiler](https://github.com/JuniorTour/vue-template-babel-compiler "https://github.com/JuniorTour/vue-template-babel-compiler")æ—¶ã€‚

å½“æ—¶è¿™ä¸ªåº“åˆšåˆšå¼€å§‹å¼€å‘ï¼Œç»å¸¸éœ€è¦åœ¨æ·»åŠ æ–°ä»£ç é€»è¾‘åï¼Œå›è¿‡å¤´å»æµ‹è¯•éªŒè¯å·²æœ‰çš„åŠŸèƒ½é€»è¾‘æ˜¯å¦ä»ç„¶æ­£å¸¸ï¼Œè¿›è¡Œäº†å¤§é‡çš„é‡å¤æµ‹è¯•å·¥ä½œï¼Œéå¸¸å½±å“å¼€å‘ä½“éªŒå’Œæ•ˆç‡ã€‚

è¿™æ—¶æˆ‘æ‰æ„è¯†åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ„ä¹‰æ‰€åœ¨ï¼Œå¦‚æœåœ¨æ·»åŠ æ–°çš„ä»£ç é€»è¾‘æ—¶ï¼Œæœ‰è¶³å¤Ÿæ•°é‡çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¯ä»¥å¸®æˆ‘éªŒè¯å·²æœ‰çš„åŠŸèƒ½é€»è¾‘ä¸€åˆ‡æ­£å¸¸ã€ä¸å—å½±å“ï¼Œæˆ‘å°±å¯ä»¥ä»é‡å¤ç¹ççš„æµ‹è¯•ä¸­è§£æ”¾å‡ºæ¥ï¼ŒæŠŠæ›´å¤šçš„æ—¶é—´ç²¾åŠ›æŠ•å…¥åˆ°åŠŸèƒ½å¼€å‘ä¸­å»ã€‚

æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ä¿é©¾æŠ¤èˆªï¼Œæ¯æ¬¡æ”¹åŠ¨ä»£ç åï¼Œåªè¦æˆ‘èŠ±ä¸Šå‡ ç§’é’Ÿæ‰§è¡Œä¸€è¡Œ`npm run test`å‘½ä»¤ï¼Œçœ‹åˆ°å®ƒè¿”å›æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œæˆ‘å°±å¯ä»¥ä¿¡å¿ƒæ»¡æ»¡çš„æäº¤æ–°å†™çš„ä»£ç ï¼Œä¸å¿…æ‹…å¿ƒåŠŸèƒ½å‡ºç°è¡°é€€ï¼ˆRegressionï¼‰ã€‚

çŠ¯é”™ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ä¸€é”™å†é”™ã€‚è‡ªåŠ¨åŒ–æµ‹è¯•å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å‡è½»æµ‹è¯•å·¥ä½œè´Ÿæ‹…ã€é¿å…é‡å¤çŠ¯é”™ï¼Œè§„é¿åŠŸèƒ½è¡°é€€çš„çµä¸¹å¦™è¯ã€‚

è‡ªåŠ¨åŒ–æµ‹è¯•æ— æ³•ä¿è¯æˆ‘ä»¬ä¸å‡ºæ–°BUGï¼Œä½†æ˜¯èƒ½ç¡®ä¿æˆ‘ä»¬ä¸ä¼šé‡å¤å‡ºç°æ—§BUGï¼Œå¸®åŠ©æˆ‘ä»¬é¿å…åœ¨åŒä¸€ä¸ªåœ°æ–¹è·Œå€’ä¸¤æ¬¡ï¼ŒåŒæ—¶æŠŠæˆ‘ä»¬ä»é‡å¤ç¹ççš„æµ‹è¯•å·¥ä½œè§£æ”¾å‡ºæ¥ã€‚

ä¸ºå‰ç«¯é¡¹ç›®å¢åŠ è‡ªåŠ¨åŒ–æµ‹è¯•å¾ˆç®€å•ï¼Œå·¥ä½œé‡ä¸å¤§ï¼Œå¯¹å¼€å‘ä½“éªŒçš„æå‡åˆååˆ†æ˜¾è‘—ï¼ŒæŠ•å…¥äº§å‡ºæ¯”æé«˜ã€‚

ä¸‹é¢æˆ‘ä»¬å°±æ¥å­¦ä¹ 2ä¸ªä¹…ç»è€ƒéªŒçš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·åŠå…¶æ¥å…¥ç¤ºä¾‹ã€‚

### 1\. **å•å…ƒæµ‹è¯•æ¡†æ¶ Jest**

å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰æ˜¯æŒ‡æµ‹è¯•é¡¹ç›®å†…å‡½æ•°ã€ç»„ä»¶ç­‰ç‹¬ç«‹å°è§„æ¨¡å•å…ƒæ¨¡å—çš„æµ‹è¯•ç±»å‹ã€‚

ä¸šå†…æœ€è´Ÿç››åçš„æ¡†æ¶å°±æ˜¯[Jest](https://jestjs.io/ "https://jestjs.io/")ï¼Œå·²ç»è¿­ä»£äº†29+ä¸ªç‰ˆæœ¬ï¼Œé•¿ç››ä¸è¡°ï¼ŒåŠŸèƒ½å¼ºå¤§åˆç®€å•æ˜“ç”¨ã€‚ä½œä¸ºä¸€ä¸ªåŸºç¡€æ¡†æ¶ï¼Œå¯¹Node.jsï¼ŒReact ç»„ä»¶ã€Vue.jsç»„ä»¶ç­‰ç­‰å‰ç«¯æ¡†æ¶éƒ½æœ‰æ‹“å±•æ”¯æŒã€‚

å¯¹äºæˆ‘ä»¬é¡¹ç›®ä¸­çš„React ç»„ä»¶è¿›è¡ŒåŸºäºJestçš„å•å…ƒæµ‹è¯•ï¼Œéœ€è¦3é¡¹ä¾èµ–ï¼š

*   `jest`ï¼šæ¡†æ¶è¿è¡Œæ—¶ï¼Œæä¾›è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„`test(name, fn, timeout)`æ–¹æ³•ï¼Œå’Œä¼—å¤šåˆ¤æ–­æµ‹è¯•è¿è¡ŒçŠ¶æ€çš„æ–­è¨€ï¼Œä¾‹å¦‚â€œæœŸæœ›å˜é‡å…·æœ‰å€¼ä¸º1çš„lengthå±æ€§â€ï¼š `expect(variable).toHaveLength(1)`ã€‚
*   `@testing-library/react`ï¼šä¸»è¦æä¾›`render(ui: React.ReactElement<any>,options?: {})`æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨Jestç¯å¢ƒä¸­å¿«é€Ÿæ–¹ä¾¿çš„è¿è¡ŒReact çš„JSXè¯­æ³•ï¼Œæ¸²æŸ“å‡ºå¯¹åº”DOMã€‚
*   `jest-environment-jsdom`ï¼šä¸“ç”¨äºJestæ¡†æ¶çš„Node.jsç¯å¢ƒDOM APIæ¨¡æ‹Ÿå®ç°ï¼Œç”¨äºç¡®ä¿Jestè¿è¡Œåœ¨Node.jsç¯å¢ƒä¸­æ—¶ï¼Œä¹Ÿæœ‰æµè§ˆå™¨çš„å„ç±»APIä¾›æˆ‘ä»¬çš„ç»„ä»¶è°ƒç”¨ï¼Œä¾‹å¦‚react-routeréœ€è¦çš„History APIï¼Œç¡®ä¿æµ‹è¯•ç”¨ä¾‹è¿è¡Œæœ‰æ­£ç¡®çš„DOMè¾“å‡ºã€‚

    npm install jest @testing-library/react jest-environment-jsdom --save-dev
    

> å¦‚æœé‡åˆ° peerDependecy æŠ¥é”™ï¼Œå»ºè®®ä¿®æ”¹ @testing-library/react ç‰ˆæœ¬å·ï¼Œä¾‹å¦‚é¡¹ç›®ä½¿ç”¨React@17ï¼Œè¯·å®‰è£…@testing-library/react@12

é…ç½®ç¤ºä¾‹ï¼š

    // ./jest.config.js
    module.exports = {
      testEnvironment: 'jest-environment-jsdom',
      moduleNameMapper: {
        '\.(css|less|scss|sass)$': 'identity-obj-proxy',
      },
    };
    

åŸºç¡€é…ç½®å®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹æ­£å¼ç¼–å†™äº†æµ‹è¯•ç”¨ä¾‹äº†ï¼š

    // ./src\app\ui\app\app.spec.tsx
    import React from 'react';
    import { render, screen } from '@testing-library/react';
    import { App } from '../../index';
    
    describe('Render APP', () => {
      it('renders APP correctly', () => {
        render(<App />);
        const conduitAnchorEle = screen.queryAllByText('conduit');
        expect(conduitAnchorEle).toHaveLength(1);
      });
    });
    

ä¸Šè¿°æµ‹è¯•ç”¨ä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨`describe()`åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•ç»„ï¼Œç›®çš„æ˜¯ä¸ºäº†æŠŠåŒä¸€ç±»å‹ã€ç›¸åŒç›®æ ‡çš„æµ‹è¯•ç”¨ä¾‹ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼Œä¾‹å¦‚æ·»åŠ `beforeEach(), afterAll()`ç­‰é’©å­å‡½æ•°ã€‚

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨`it(name, TestFn)`åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨ç¬¬2ä¸ªå‚æ•°çš„å‡½æ•°ä¸­å°±å¯ä»¥ç¼–å†™æˆ‘ä»¬çš„æµ‹è¯•å†…å®¹äº†ã€‚

æµ‹è¯•çš„å†…å®¹å¾ˆç®€å•ï¼Œè°ƒç”¨`@testing-library/react`æä¾›çš„å¯ä»¥åœ¨Node.jsç¯å¢ƒæ¸²æŸ“Reactç»„ä»¶çš„`render()`æ–¹æ³•ï¼Œå°†`<App />`ç»„ä»¶æ¸²æŸ“åˆ°å½“å‰çš„å†…å­˜ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥ç”¨`screen`ç±»ä¸­çš„`queryAllByText()`ç­‰APIè·å–ã€æ£€æµ‹ç»„ä»¶çš„æ‰§è¡Œé€»è¾‘ã€DOMæ¸²æŸ“æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

å¹¶æœ€ç»ˆä½¿ç”¨jestçš„æ–­è¨€API `expect()`ï¼Œåˆ¤æ–­è¿™æ¬¡çš„ä»£ç è¿è¡Œæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œæ¸²æŸ“å‡ºäº†1ä¸ª`conduitAnchorEle`å…ƒç´ ï¼ˆ`.toHaveLength(1)`ï¼‰ã€‚

é™¤äº†å¯¹ç»„ä»¶è¿›è¡Œæµ‹è¯•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹åŠŸèƒ½å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ä¸‹åˆ—æµ‹è¯•ç”¨ä¾‹ä»£ç å¯¹`limit`å‡½æ•°çš„å„ç±»æƒ…å†µè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼š

    // utils.ts
    export const limit = (count: number, pageIndex: number): string =>
      `limit=${count}&offset=${pageIndex * count}`;
    
    // utils.test.js
    import { limit } from '../utils';
    
    describe('limit', () => {
      it('should return the correct limit string', () => {
        const count = 10;
        const pageIndex = 2;
    
        const result = limit(count, pageIndex);
    
        expect(result).toEqual(`limit=${count}&offset=${pageIndex}`);
      });
    
      it('should handle zero count correctly', () => {
        const count = 0;
        const pageIndex = 5;
    
        const result = limit(count, pageIndex);
    
        expect(result).toEqual(`limit=${count}&offset=${pageIndex}`);
      });
    
      it('should handle negative pageIndex correctly', () => {
        const count = 20;
        const pageIndex = -3;
    
        const result = limit(count, pageIndex);
    
        expect(result).toEqual(`limit=${count}&offset=${pageIndex}`);
      });
    });
    

### 2\. **ç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶ Playwright**

ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆEnd To End Test, E2Eï¼‰æ˜¯æŒ‡æµ‹è¯•é¡¹ç›®ä»ä¸€ç«¯åˆ°å¦ä¸€ç«¯ï¼ˆå¦‚å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ï¼‰å®Œæ•´æ“ä½œæµç¨‹çš„æµ‹è¯•ç±»å‹ã€‚

è¿‘å¹´æ¥ä¸šå†…æœ€æµè¡Œçš„E2Eæµ‹è¯•å·¥å…·é Playwright ï¼ˆ[playwright.dev/ï¼‰è«å±ï¼Œå®ƒç”±å¾®è½¯å¼€æºï¼Œâ€¦](https://playwright.dev/%EF%BC%89%E8%8E%AB%E5%B1%9E%EF%BC%8C%E5%AE%83%E7%94%B1%E5%BE%AE%E8%BD%AF%E5%BC%80%E6%BA%90%EF%BC%8C%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8Chrome%E3%80%81FireFox%E3%80%81Edge%E3%80%81Safari%E7%AD%89%E5%90%84%E5%A4%A7%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%EF%BC%8C%E5%8F%AF%E7%94%A8%E4%BA%8E%E6%A3%80%E6%9F%A5%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%EF%BC%8C%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E6%9E%81%E4%BD%B3%E3%80%82 "https://playwright.dev/%EF%BC%89%E8%8E%AB%E5%B1%9E%EF%BC%8C%E5%AE%83%E7%94%B1%E5%BE%AE%E8%BD%AF%E5%BC%80%E6%BA%90%EF%BC%8C%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8Chrome%E3%80%81FireFox%E3%80%81Edge%E3%80%81Safari%E7%AD%89%E5%90%84%E5%A4%A7%E6%B5%8F%E8%A7%88%E5%99%A8%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%EF%BC%8C%E5%8F%AF%E7%94%A8%E4%BA%8E%E6%A3%80%E6%9F%A5%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%EF%BC%8C%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E6%9E%81%E4%BD%B3%E3%80%82")

Playwrightå®‰è£…ä½¿ç”¨éå¸¸ç®€å•ï¼šæ¨èä½¿ç”¨`npm init`å‘½ä»¤å®‰è£…ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š

    npm init playwright@latest
    

åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡äº¤äº’å¼å‘½ä»¤è¡Œçš„å½¢å¼ï¼Œå¼•å¯¼é€‰æ‹©å®‰è£…CIé…ç½®ã€æµè§ˆå™¨è¿è¡Œæ—¶ç­‰å¯é€‰ä¾èµ–ï¼Œä½“éªŒè¾ƒå¥½ï¼š

    Need to install the following packages:
      create-playwright@1.17.128
    Ok to proceed? (y) y
    Getting started with writing end-to-end tests with Playwright:
    Initializing project in '.'
    âœ” Where to put your end-to-end tests? Â· tests
    âœ” Add a GitHub Actions workflow? (y/N) Â· false
    âœ” Install Playwright browsers (can be done manually via 'npx playwright install')? (Y/n) Â· true
    âœ” Install Playwright operating system dependencies (requires sudo / root - can be done manually via 'sudo npx playwright install-deps')? (y/N) Â· false
    

å®‰è£…è¿‡ç¨‹ä¸»è¦ä¼šç”Ÿæˆï¼š

*   å®‰è£…`@playwright/test`æ ¸å¿ƒä¾èµ–
    
*   `./playwright.config.ts`ï¼šé»˜è®¤é…ç½®ä¸€å¥—ï¼Œå…¶ä¸­ï¼š
    
    *   `workers`å­—æ®µæŒ‡å®šè¿è¡Œæµ‹è¯•æ—¶å¼€å¯å¤šå°‘ä¸ªNode.jsçº¿ç¨‹ï¼Œé»˜è®¤ä¸º`undefined`ï¼Œè¡¨ç¤ºä¸é™çº¿ç¨‹æ•°é‡ï¼Œplaywrightä¼šå°½å¯èƒ½åœ°å¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¼€å¯ä¸€ä¸ªç‹¬ç«‹çº¿ç¨‹ï¼Œä»¥ä¾¿åŠ å¿«æµ‹è¯•å®Œæˆé€Ÿåº¦ã€‚
    *   `reporter`å­—æ®µæŒ‡å®šæµ‹è¯•ç»“æœçš„æ±‡æ€»æŠ¥å‘Šå½¢å¼ï¼Œé»˜è®¤ä¸º`'html'`ï¼Œå³æµ‹è¯•ç»“æœä¼šç”Ÿæˆä¸€ä»½HTMLé¡µé¢ï¼ˆå¦‚ä¸‹å›¾ï¼‰ä»¥ä¾¿äºè§‚çœ‹ã€‚æ­¤å¤–å¸¸ç”¨çš„è¿˜æœ‰JSONæ ¼å¼æŠ¥å‘Šï¼ˆ`['json', { outputFile: './report.json' }]`ï¼‰ï¼Œå¯ç”¨äºè¿›ä¸€æ­¥å¤„ç†æµ‹è¯•ç»“æœã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/050147c633bc46e885421ef45cb9b961~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1912&h=971&s=117874&e=png&b=151515)

*   `projects`å­—æ®µå¯ç”¨äºæŒ‡å®šä½¿ç”¨å“ªäº›æµè§ˆå™¨è¿è¡Œæ—¶è¿›è¡Œå…¼å®¹æ€§æµ‹è¯•ï¼Œå¯ä»¥æŒ‰éœ€å¢å‡ã€‚ä¾‹å¦‚ï¼š

    import { defineConfig, devices } from '@playwright/test';
    
    export default defineConfig({
      projects: [
        {
          name: 'firefox',
          use: { â€¦devices['Desktop Firefox'] },
        },
        {
          name: 'Microsoft Edge',
          use: {
            â€¦devices['Desktop Edge'],
            channel: 'msedge'
          },
        },
        {
          name: 'Google Chrome',
          use: {
            â€¦devices['Desktop Chrome'],
            channel: 'chrome'
          },
        },  {  name : 'Mobile Chrome' ,  use : { â€¦devices[ 'Pixel 5' ] }, }, {  name : 'Mobile Safari' ,  use : { â€¦devices[ 'iPhone 12' ] }, },
      ],
    });
    

*   ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹2ä¸ªï¼š
    
    *   `tests\example.spec.ts`ï¼šåŸºç¡€APIç®€å•ç¤ºä¾‹
    *   `tests-examples\demo-todo-app.spec.ts`ï¼šå¯¹ä¸€ä¸ªTODO List å‰ç«¯åº”ç”¨è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œçš„å¤æ‚ç¤ºä¾‹

å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œ`npx playwright test example.spec.ts`ï¼Œå³å¯è¿è¡Œè‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œåçš„æµ‹è¯•ç»“æœä¿å­˜åœ¨`./playwright-report/index.html`ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ`npx playwright show-report`ä¾›æœ¬åœ°æµè§ˆã€‚

å¸¸ç”¨çš„å‘½ä»¤è¡Œå‚æ•°è¿˜æœ‰ï¼š

*   è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼š`npx playwright test`
*   è¿è¡Œæ–‡ä»¶ååŒ…å«å…³é”®å­—exampleçš„æµ‹è¯•ç”¨ä¾‹ï¼š`npx playwright test example`
*   `--debug`ä»¥è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼š`npx playwright test example.spec.ts --debug`ï¼Œè¿è¡Œåï¼Œå°†è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çª—å£å’ŒPlaywrightçš„è°ƒè¯•å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬ä¸€æ­¥æ­¥è°ƒè¯•è¿è¡Œç›®æ ‡æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•å·¥å…·ä¸­çš„Pick Locator æŒ‰é’®ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½æµ‹è¯•ç›®æ ‡å…ƒç´ åŸºäºPlaywright APIçš„é€‰æ‹©ç¬¦ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca5b7014fb534343af902e99c465f40d~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1862&h=984&s=221013&e=png&b=1d1d1d)

äº†è§£äº†åŸºç¡€ç”¨æ³•ï¼Œä¸‹é¢å†æ¼”ç¤ºä¸€ä¸‹ä¸ºç¤ºä¾‹å‰ç«¯é¡¹ç›®å¢åŠ ä¸€ä¸ªåŸºæœ¬çš„E2Eæµ‹è¯•ç”¨ä¾‹ï¼š

    // ./tests/homepage.spec.ts
    import { test, expect } from '@playwright/test';
    
    test('Home page should render successfully', async ({ page }) => {
      await page.goto('http://localhost:4100/home/');
    
      await expect(page).toHaveTitle(/ã€Šç°ä»£å‰ç«¯å·¥ç¨‹ä½“éªŒä¼˜åŒ–ã€‹ç¤ºä¾‹é¡¹ç›®/);
    
      await expect(await page.getByRole('link', { name: 'ã€Šç°ä»£å‰ç«¯å·¥ç¨‹ä½“éªŒä¼˜åŒ–ã€‹demo' }))
        .toBeVisible();
      const signUpPageLinkBtn = await page.getByRole('link', { name: 'Sign Up' });
      await expect(signUpPageLinkBtn).toBeVisible();
      await signUpPageLinkBtn.click();
    
      await page.waitForTimeout(500);
      await expect(
        await page.getByRole('button', { name: 'Sign Up' }),
      ).toBeVisible();
    });
    

è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹åœ¨æœ¬åœ°ç¯å¢ƒçš„ä¸»é¡µé¡µé¢ï¼ˆ[http://localhost:4100/home/ï¼‰ä¸Šï¼š](http://localhost:4100/home/%EF%BC%89%E4%B8%8A%EF%BC%9A "http://localhost:4100/home/%EF%BC%89%E4%B8%8A%EF%BC%9A")

1.  è°ƒç”¨playwrightçš„è¿è¡Œæ—¶API `page.getByRole()`è·å–é¡µé¢ä¸Šçš„DOMå…ƒç´ å¼•ç”¨ã€‚
2.  å¹¶æ‰§è¡Œä¸€ç³»åˆ—ç‚¹å‡»æ“ä½œå¹¶è°ƒç”¨æ–­è¨€ï¼ˆ`expect()`ï¼‰ï¼Œåˆ¤æ–­é¡µé¢æ˜¯å¦æˆåŠŸæ¸²æŸ“ï¼Œé¡µé¢æ ‡é¢˜ã€é“¾æ¥å’ŒæŒ‰é’®ç­‰å…ƒç´ æ˜¯å¦æ­£å¸¸æ˜¾ç¤ºï¼ˆ`toBeVisible()`ï¼‰ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿è¡Œå‰ç«¯åº”ç”¨çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œä¾›Playwrightè®¿é—®ï¼Œè¿™ä¸€ç‚¹Playwrightè´´å¿ƒåœ°æä¾›äº†[webServer](https://playwright.dev/docs/test-webserver#configuring-a-web-server "https://playwright.dev/docs/test-webserver#configuring-a-web-server")é…ç½®ï¼Œå¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹å¼€å§‹å‰ï¼Œè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ã€å¯åŠ¨æµ‹è¯•ç”¨ç¯å¢ƒã€‚

    export default defineConfig({
      webServer: {
        command: 'npm run dev',
        port: 4100,
        reuseExistingServer: !process.env.CI,
        stdout: 'pipe',
        stderr: 'pipe',
        timeout: 60 * 1000,
      },
    }
    

æœ€åï¼Œåœ¨`package.json`ä¸­æ·»åŠ è¿è¡Œå‘½ä»¤åï¼Œå³å¯æ–¹ä¾¿åœ°è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¾—åˆ°æµ‹è¯•ç»“æœã€‚

    "scripts": {    
        "test:ci": "npx playwright test",
    }
    

è¿™äº›æµ‹è¯•ç”¨ä¾‹ç§¯å°‘æˆå¤šï¼Œèƒ½æœ‰æ•ˆé¿å…æˆ‘ä»¬çš„å‰ç«¯ä¼˜åŒ–å‡ºç°åŠŸèƒ½è¡°é€€ï¼Œå½“æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…ä»¥å¿å¿‘ä¸å®‰çš„å¿ƒæƒ…ï¼Œçœ‹åˆ°æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡æ—¶ï¼Œç›¸ä¿¡å¯¹è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ„ä¹‰ä¼šæœ‰æ›´åˆ‡èº«çš„ä½“ä¼šï¼Œèƒ½çœŸåˆ‡åœ°æ„Ÿå—åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•å¯¹å·¥ä½œæ•ˆç‡å’Œå¼€å‘ä½“éªŒçš„å·¨å¤§æå‡ã€‚

3\. **æŒç»­é›†æˆ(Continuous Integrationï¼ŒCI)**
---------------------------------------

ä¸Šé¢ä»‹ç»çš„è®¸å¤šå·¥å…·ï¼Œä¸¥æ ¼æ¥è¯´è¿˜æ˜¯åŠè‡ªåŠ¨åŒ–çŠ¶æ€ï¼Œå…¶è¿è¡Œå¿…é¡»ä¾èµ–å¼€å‘è€…çš„æ‰‹åŠ¨è°ƒç”¨ã€‚

è¦æƒ³å®ç°çœŸæ­£çš„å…¨è‡ªåŠ¨åŒ–ï¼Œ**æŒç»­é›†æˆ**å¿…ä¸å¯å°‘ã€‚

æŒç»­é›†æˆ(Continuous Integrationï¼ŒCI)æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œä½¿ç”¨ä¸“ç”¨çš„CIç¯å¢ƒï¼Œè‡ªåŠ¨æ‰§è¡Œæ„å»ºï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²ç­‰æ­¥éª¤ï¼Œä»è€Œé¢„å…ˆå‘ç°é—®é¢˜ï¼Œç¡®ä¿ä»£ç è´¨é‡ï¼Œä¼˜åŒ–å¼€å‘ä½“éªŒã€‚

### **CIå·¥å…·ç®€ä»‹**

è¿‘å¹´æ¥ï¼Œæ¯”è¾ƒæµè¡Œçš„CIå·¥å…·ä¸»è¦æœ‰ï¼š

#### 1\. **GitLab CI**

å’ŒGitLabä»£ç ä»“åº“é…å¥—çš„æŒç»­é›†æˆå·¥å…·ã€‚é€šè¿‡ä»£ç ä¸­çš„`.gitlab-ci.yml`é…ç½®æ–‡ä»¶å®šä¹‰å¤šç»„å·¥ä½œ(`job`)åŠå…¶æ‰§è¡Œçš„å‘½ä»¤(`script`)ï¼Œæ¥å®ç°è‡ªåŠ¨åŒ–è¿è¡Œæ„å»ºæµ‹è¯•ç­‰æ­¥éª¤ã€‚

ç¤ºä¾‹é…ç½®å¦‚ä¸‹ï¼š

    image: node:latest
    
    # å®šä¹‰å·¥ä½œ job
    build:
      stage: build
      script:
        - npm install
        - npm run build
    deploy:
      stage: deploy
      script:
        - aws s3 sync dist s3://your-bucket-name --acl public-read  # ä¸Šä¼ é™æ€èµ„æºåˆ°CDN
      only:
        - master  # ä»…åœ¨ master åˆ†æ”¯ä¸Šè§¦å‘éƒ¨ç½²
    
    # å®šä¹‰å…¨å±€å˜é‡
    variables:
      NODE_ENV: production
    

ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ`.gitlab-ci.yml`æ–‡ä»¶å®šä¹‰äº†ä¸¤ä¸ªjobï¼š

1.  `build`ï¼šç”¨äºæ„å»ºå‰ç«¯é¡¹ç›®ï¼Œå®ƒä½¿ç”¨`node:latest`é•œåƒä½œä¸ºè¿è¡Œç¯å¢ƒï¼Œæ‰§è¡Œäº†å®‰è£…ä¾èµ–å’Œæ„å»ºå‘½ä»¤ï¼Œå¹¶å°†æ„å»ºåçš„è¾“å‡ºç›®å½•dist/å®šä¹‰ä¸ºæ„å»ºäº§ç‰©(artifacts)ã€‚
    
2.  `deploy`ï¼šç”¨äºéƒ¨ç½²å‰ç«¯é¡¹ç›®ï¼Œä½¿ç”¨`aws`å‘½ä»¤è¡Œï¼Œå°†`dist`ç›®å½•ä¸­çš„æ„å»ºäº§ç‰©ä¸Šä¼ åˆ°CDNæœåŠ¡å™¨ï¼ŒåŒæ—¶æŒ‡å®šäº†è¯¥å·¥ä½œåªåœ¨`master`åˆ†æ”¯ä¸Šè§¦å‘ã€‚
    

#### 2\. **GitHub Actions**

æ˜¯å’ŒGitHubä»“åº“é…å¥—çš„æŒç»­é›†æˆå·¥å…·ï¼Œç±»ä¼¼Gitlab CIï¼Œä¹Ÿæœ‰å·¥ä½œ`job`çš„æ¦‚å¿µï¼Œå¯ä»¥æŒ‡å®šå·¥ä½œçš„å…·ä½“æ­¥éª¤`steps`è¦æ‰§è¡Œå“ªäº›è‡ªåŠ¨åŒ–å‘½ä»¤ï¼Œä»¥åŠæ‰§è¡Œçš„æ¡ä»¶ï¼ˆ`on`ï¼‰ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºç¡€çš„å‰ç«¯åº”ç”¨GitHub Actionsé…ç½®ï¼š

    name: Front-End CI Example
    
    on:
      push:
        branches: [ "main" ]
      pull_request:
        branches: [ "main" ]
    
    jobs:
      build:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v3
        - name: Use Node.js 18
          uses: actions/setup-node@v3
          with:
            node-version: '18.x'
            cache: 'npm'
        - run: npm install
        - run: npm run build
        - run: npm test
    

ä¸»è¦åŒ…å«1ä¸ª`build`jobï¼Œå…¶å…·ä½“å·¥ä½œæ­¥éª¤æ˜¯ï¼š

*   ä½¿ç”¨[GitHub actionså¸‚åœº](https://github.com/marketplace?type=actions "https://github.com/marketplace?type=actions")ï¼ˆç±»ä¼¼NPMï¼‰ä¸­çš„[actions/checkout@v3](https://github.com/actions/checkout "https://github.com/actions/checkout")ï¼Œä¸‹è½½å¹¶åˆ‡æ¢Gitä»“åº“çš„ä»£ç ã€‚
*   å†ä½¿ç”¨[actions/setup-node](https://github.com/actions/setup-node "https://github.com/actions/setup-node")ï¼Œåˆå§‹åŒ–Node.jsç¯å¢ƒã€‚
*   æœ€åæ‰§è¡Œ`npm installã€npm run buildã€npm run test`ç­‰ä¸€ç³»åˆ—å‘½ä»¤ï¼Œå®ç°è‡ªåŠ¨åŒ–è¿è¡Œæ„å»ºå’Œæµ‹è¯•ã€‚

é€šè¿‡ä»¥ä¸Šç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼ŒGitHub actionså› ä¸ºæœ‰ç¹è£çš„[GitHub actionså¸‚åœº](https://github.com/marketplace?type=actions "https://github.com/marketplace?type=actions")ï¼Œæ‰€ä»¥èƒ½åƒå¤ç”¨NPMåŒ…é‚£æ ·ï¼Œå¿«é€Ÿæ­å»ºå‡ºCIï¼Œå¼€å‘ä½“éªŒå’Œæ•ˆç‡éƒ½æ¯”è¾ƒå¥½ï¼Œè¿™æ˜¯GitHub actionsçš„ä¸€å¤§**ä¼˜åŠ¿**ã€‚

#### 3\. Jenkins

Jenkinsï¼ˆ[www.jenkins.io/](https://www.jenkins.io/ "https://www.jenkins.io/") ï¼‰æ˜¯ä¸€å¥—ç‹¬ç«‹ä¸”å¼€æºçš„æŒç»­é›†æˆè§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«å¯è§†åŒ–æ“ä½œç•Œé¢å‰ç«¯åº”ç”¨ï¼Œè¿è¡Œç¯å¢ƒæœåŠ¡å™¨åº”ç”¨ä»¥åŠç¹è£çš„æ’ä»¶ç”Ÿæ€ã€‚

å’Œä¸Šæ–‡æåˆ°çš„2ç±»CIä¸åŒï¼Œ

*   Jenkinsæ”¯æŒç§æœ‰åŒ–éƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ç”¨è‡ªå·±æ‹¥æœ‰çš„æœåŠ¡å™¨è¿è¡ŒJenkinsï¼Œè¿›è€Œæ‰§è¡Œå„ç±»è‡ªåŠ¨åŒ–æ­¥éª¤ã€‚è¿™ä¹Ÿæ˜¯Jenkinsçš„ä¸€å¤§**ç‰¹æœ‰ä¼˜åŠ¿**ã€‚
*   å¦ä¸€æ–¹é¢ï¼ŒJenkinsæœ‰ä¸€å¥—å¯è§†åŒ–å‰ç«¯ç•Œé¢ï¼Œå¯ä»¥ä¾›å¼€å‘è€…ç›´è§‚åœ°åˆ›å»ºã€é…ç½®è¦æ‰§è¡ŒCIçš„é¡¹ç›®åŠå…¶å…·ä½“å·¥ä½œã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd90c1f01d9841aba2ba5a31bf475962~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=983&h=565&s=144009&e=png&b=efefef)

Jenkinsä¹Ÿæ”¯æŒé€šè¿‡ä»£ç ä»“åº“å†…çš„`Jenkinsfile`æ–‡ä»¶é…ç½®å®ç°æŒ‡å®šå·¥ä½œåŠå…·ä½“æ­¥éª¤ï¼Œ`Jenkinsfile`æ˜¯ä¸€ç§åŸºäº`Groovy`è¯­è¨€çš„è„šæœ¬æ–‡ä»¶ï¼Œå¯ç”¨äºæè¿°æ•´ä¸ªæ„å»ºå’Œéƒ¨ç½²çš„æµç¨‹ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºç¡€çš„å‰ç«¯åº”ç”¨çš„ Jenkinsfile ç¤ºä¾‹ï¼š

    pipeline {
        agent any
    
        stages {
            stage('Checkout') {
                steps {
                    checkout scm
                }
            }
    
            stage('Install dependencies') {
                steps {
                    sh 'npm install'
                }
            }
    
            stage('Build') {
                steps {
                    sh 'npm run build'
                }
            }
    
            stage('Test') {
                steps {
                    sh 'npm test'
                }
            }
    
            stage('Deploy') {
                steps {
                    // æ·»åŠ éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„æ­¥éª¤
                    // sh 'npm run deploy'
                }
            }
        }
    }
    

äº†è§£äº†æµè¡Œçš„CIå·¥å…·åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥å¼€å‘ä½“éªŒè¾ƒå¥½çš„GitHub Action CIä¸ºä¾‹ï¼Œæ¼”ç¤ºCIçš„3ç§å®ç”¨åœºæ™¯ã€‚

### 1\. **åˆ›å»ºMRæ—¶è‡ªåŠ¨åŒ–è¿è¡Œæ„å»ºï¼Œæ£€æŸ¥å’Œæµ‹è¯•**

CIæœ€å¸¸è§ä¹Ÿæœ€å®ç”¨çš„åœºæ™¯å°±æ˜¯å¸®æˆ‘ä»¬è¿è¡Œæœ¬èŠ‚ä»‹ç»çš„å„ç±»ä»£ç æ£€æŸ¥å’Œæµ‹è¯•ã€‚

ä½†å› ä¸ºCIæœ‰ç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒå’Œæ—¶æœºï¼Œæ‰€ä»¥å¸¸è§çš„ç”¨æ³•æ˜¯åœ¨åˆ›å»ºMRæ—¶ï¼Œç”¨CIè‡ªåŠ¨åŒ–æ‰§è¡Œé¡¹ç›®æ„å»ºï¼Œä»£ç æ£€æŸ¥å’Œå„ç±»æµ‹è¯•ã€‚

åœ¨åˆ›å»ºMRæ—¶è¿›è¡Œè¿™äº›å·¥ä½œä¹Ÿæ˜¯å‰ç«¯å¼€å‘å¿…ä¸å¯å°‘çš„ä¿éšœï¼Œèƒ½æœ‰æ•ˆä¿è¯ä¸»åˆ†æ”¯ä»£ç å› ä¸ºä»£ç é”™è¯¯å¯¼è‡´è´¨é‡æ¶åŒ–ï¼Œé¿å…é¡¹ç›®çº¿ä¸Šç¯å¢ƒå‡ºç°è¯­æ³•é”™è¯¯ç­‰ä¸¥é‡ç¼ºé™·ã€‚

ç”¨GitHub Actionå®ç°åˆ›å»ºMRæ—¶è¿è¡Œè‡ªåŠ¨åŒ–æ£€æŸ¥éå¸¸ç®€å•ï¼Œåªéœ€è¦20+è¡Œä»£ç é…ç½®å³å¯å®ç°ï¼š

> å®Œæ•´ä»£ç ç¤ºä¾‹ï¼šã€Šfeat: Test and ciã€‹[github.com/JuniorTour/â€¦](https://github.com/JuniorTour/fe-optimization-demo/pull/12/checks "https://github.com/JuniorTour/fe-optimization-demo/pull/12/checks")

    name: 'Merge Request CI'
    
    on: 
      pull_request:
        branches: [ "main" ]
    
    # å®šä¹‰å·¥ä½œ job
    jobs:
      build:
        runs-on: ubuntu-latest
        name: build
        steps:
          - name: Checkout ğŸ›ï¸
            uses: actions/checkout@v3
          - name: Use Node.js 18.x
            uses: actions/setup-node@v3
            with:
              node-version: '18.x'
          - name: Installing my packages
            run: npm install
          - name: Lint
            run: npm run lint
          - name: Build App
            run: npm run build
          - name: Test
            run: npm run test:ci
    

ä¸Šè¿°é…ç½®ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡`on`å…³é”®å­—ï¼ŒæŒ‡å®šäº†è¿™ä»½é…ç½®è§¦å‘çš„æ—¶æœºæ˜¯åˆ›å»ºPRæ—¶ï¼ˆ`pull_request:`ï¼‰ï¼Œå¹¶ä¸”ç›®æ ‡åˆ†æ”¯ä¸º`main`ï¼ˆ`branches: [ "main" ]`ï¼‰ã€‚

ç„¶åï¼Œå®šä¹‰äº†1ä¸ªå·¥ä½œ jobåä¸º`build`ï¼Œåœ¨è¿™ä¸ªå·¥ä½œä¸­ï¼Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨å¸‚åœºä¸­å·²æœ‰çš„Actionsç‰‡æ®µ`actions/checkout@v3`å’Œ`actions/setup-node@v3`ï¼Œæ–¹ä¾¿å¿«é€Ÿåœ°åˆå§‹åŒ–CIç¯å¢ƒã€‚

æ¥ä¸‹æ¥ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œå®‰è£…ä¾èµ–å’Œæˆ‘ä»¬åœ¨`package.json`ä¸­å®šä¹‰çš„ä»£ç æ£€æŸ¥ã€æ„å»ºå’Œplaywright `e2e`æµ‹è¯•å‘½ä»¤ã€‚

è¿™æ ·å°±å®ç°äº†ï¼Œå½“åˆ›å»ºPRï¼ˆMRï¼‰æ—¶ï¼Œè‡ªåŠ¨æ„å»ºã€æ£€æŸ¥ä»£ç å¹¶è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè¿™äº›è‡ªåŠ¨åŒ–å·¥ä½œçš„ç»“æœéƒ½ä¼šåœ¨PRé¡µé¢å¯è§†åŒ–å±•ç¤ºï¼Œå¦‚æœCIè¿è¡ŒæŠ¥é”™ã€æœªå®Œæˆï¼ŒMRå°±ä¸èƒ½é¡ºåˆ©åˆå…¥ã€‚

åä¹‹ï¼Œä»£ç æ²¡æœ‰è¯­æ³•é”™è¯¯ã€æ„å»ºæˆåŠŸã€æµ‹è¯•ç”¨ä¾‹é¡ºåˆ©é€šè¿‡ï¼ŒMRæ‰èƒ½åˆå…¥ä¸»åˆ†æ”¯ï¼Œæœ‰æ•ˆåœ°ä¿æŠ¤äº†ä»£ç è´¨é‡ã€‚è‡ªåŠ¨åŒ–æ‰§è¡Œå„ç±»é‡å¤çš„å·¥ä½œï¼Œä¹Ÿå¯ä»¥æ˜¾è‘—èŠ‚çœå¼€å‘è€…çš„æ—¶é—´å’Œç²¾åŠ›ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/329066d98dc7405a888a35735f7c3061~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1366&h=622&s=89887&e=png&b=0f141a)

### 2\. **è‡ªåŠ¨åŒ–å‘å¸ƒNPMåŒ…**

ç¬¬äºŒç±»è¦ä»‹ç»çš„CIä½¿ç”¨åœºæ™¯æ˜¯ã€Šè‡ªåŠ¨åŒ–å‘å¸ƒNPMåŒ…ã€‹ã€‚

å¯¹äºéœ€è¦å‘å¸ƒNPMåŒ…çš„ä»£ç ä»“åº“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨GitHub Actionå’Œå¸‚åœºä¸­çš„é…ç½®ï¼Œç®€å•æ–¹ä¾¿åœ°å®ç°ï¼Œé…ç½®å¦‚ä¸‹ï¼š

    name: 'PublishLatestVersion'
    
    on:
      push:
        tags:
          - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10
    
    jobs:
      publish:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v1
          - uses: actions/setup-node@v1
            with:
              node-version: 14
          - run: yarn install --frozen-lockfile
          - run: yarn test
          - uses: JS-DevTools/npm-publish@v1
            with:
              token: ${{ secrets.NPM_TOKEN }}
    

è¿™ä»½é…ç½®ï¼Œè§¦å‘çš„æ—¶æœºæ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯åœ¨Gitä»“åº“æ”¶åˆ°äº†æ¨é€çš„`tags`æ—¶ï¼Œå¹¶ä¸”tagsçš„åç§°ä»¥`v`å­—æ¯å¼€å¤´ï¼ˆ`'v*'`ï¼‰æ‰ä¼šè§¦å‘ã€‚æ‰§è¡Œåç»­å®šä¹‰çš„`jobs`ã€‚

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é…åˆ[Git tags](https://git-scm.com/book/en/v2/Git-Basics-Tagging "https://git-scm.com/book/en/v2/Git-Basics-Tagging")åŒæ­¥ç®¡ç†NPMå‘å¸ƒï¼Œç”šè‡³å¯ä»¥åœ¨GitHubçš„é¡µé¢ä¸­å…¨ç¨‹å¯è§†åŒ–æ“ä½œï¼Œåˆ›å»ºtagsï¼Œå®ç°è‡ªåŠ¨åŒ–å‘å¸ƒNPMåŒ…ã€‚ç›¸è¾ƒäºåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒæ‰‹åŠ¨è¾“å…¥`npm publish`ï¼Œè¿˜èƒ½è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¼€å‘ä½“éªŒéå¸¸å¥½ï¼Œæ•ˆç‡æ›´é«˜ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b2a510e9ff74f74bea92e47466da646~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.jpg#?w=1053&h=689&s=84780&e=png&b=0f131a)

### 3\. **GitHub pages è‡ªåŠ¨éƒ¨ç½²**

ç¬¬äºŒç±»è¦ä»‹ç»çš„CIä½¿ç”¨åœºæ™¯æ˜¯ã€Šè‡ªåŠ¨åŒ–éƒ¨ç½²GitHub Pagesã€‹ã€‚

GitHub Pagesæ˜¯GitHubæä¾›çš„é™æ€é¡µé¢éƒ¨ç½²åŠŸèƒ½ï¼Œè®¸å¤šå¼€æºåº“çš„æ–‡æ¡£ã€ç¤ºä¾‹é¡µé¢éƒ½æ˜¯ä½¿ç”¨Pageséƒ¨ç½²ï¼Œè‡ªå¸¦åŸŸåï¼ˆä¾‹å¦‚ï¼š[juniortour.github.io/es6-mario/pâ€¦](https://juniortour.github.io/es6-mario/public/dist/index.html%EF%BC%89%E5%92%8CCDN%E3%80%82%EF%BC%8C%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E3%80%82 "https://juniortour.github.io/es6-mario/public/dist/index.html%EF%BC%89%E5%92%8CCDN%E3%80%82%EF%BC%8C%E7%AE%80%E5%8D%95%E6%98%93%E7%94%A8%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8A%9F%E8%83%BD%E5%BC%BA%E5%A4%A7%E3%80%82")

å¤ç”¨å¸‚åœºä¸­çš„Actionsæ¨¡æ¿ï¼š[JamesIves/github-pages-deploy-action](https://github.com/JamesIves/github-pages-deploy-action "https://github.com/JamesIves/github-pages-deploy-action")ï¼Œå³å¯å¿«é€Ÿå®ç°ä»¥è‡ªåŠ¨åŒ–æ„å»ºé¡¹ç›®ï¼Œå¹¶éƒ¨ç½²åˆ°GitHub Pagesã€‚

å®Œæ•´é…ç½®ä»£ç å¦‚ä¸‹ï¼š

    name: GitHub Pages deploy
    
    on:
      push:
        branches: [main]
    
    jobs:
      build:
        runs-on: ubuntu-latest
    
        steps:
          - name: Checkout ğŸ›ï¸
            uses: actions/checkout@v2.3.1
          - name: Use Node.js 16.x
            uses: actions/setup-node@v1
            with:
              node-version: '16.x'
    
          - name: Installing my packages
            run: npm install
    
          - name: Build my App
            run: npm run build && npm run export && touch ./out/.nojekyll
    
          - name: Deploy ğŸš€
            uses: JamesIves/github-pages-deploy-action@v4.4.1
            with:
              token: ${{ secrets.CI_GITHUB_TOKEN }}
              BRANCH: public # The branch the action should deploy to.
              FOLDER: out # The folder the action should deploy.
    

è¿™ä»½é…ç½®ä¼šåœ¨ä»£ç pushåˆ°`main`åˆ†æ”¯æ—¶è§¦å‘ï¼Œä¾æ¬¡æ‰§è¡Œ`npm install`ã€`npm run build`ã€å’Œ[JamesIves/github-pages-deploy-action](https://github.com/JamesIves/github-pages-deploy-action "https://github.com/JamesIves/github-pages-deploy-action")å†…ç½®çš„é™æ€èµ„æºéƒ¨ç½²æ­¥éª¤ã€‚å®ç°ä»£ç æ¨é€åï¼Œè‡ªåŠ¨åŒ–æ„å»ºã€éƒ¨ç½²GitHub Pagesã€‚

**æ€»ç»“**
------

è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–å¼€å‘ä½“éªŒã€æé«˜å·¥ä½œæ•ˆç‡ï¼Œäº†è§£äº†5ç±»å‰ç«¯å¼€å‘æ—¶å¸¸ç”¨çš„è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥å·¥å…·ï¼š

1.  ESLint
2.  Prettier
3.  Editor Config
4.  Stylelint
5.  Commitlint

åˆå­¦ä¹ äº†è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ„ä¹‰å’ŒJestã€Playwrightè¿™2ä¸ªæµ‹è¯•å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ã€‚

æœ€åï¼Œå°†è¿™äº›å·¥å…·èä¼šè´¯é€šï¼Œæ¢ç´¢äº†æŒç»­é›†æˆçš„ç”¨æ³•å’ŒGitHub Actionsçš„3ç§å®ç”¨åœºæ™¯ã€‚
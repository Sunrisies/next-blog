上一章，我们讲述了需求评审的目的，以及在需求评审中我们程序员应该注意的事项，我们知道，对于一个需求来说，产品和开发有共同的地方，那就是：**用户量能增长**。

我们上班是为了赚钱，但是我们的工资是公司发的，公司的钱是靠用户给的，用户的钱我们做的 App 带来的。所以，我们真正的老板是用户，而不是领导，领导是直接老板，而不是最终老板；所以，讨好用户就是我们的最终目的。

那么，怎么讨好用户呢？

这就不是我们这些直男程序员的事情了，而是那些不一定高智商但一定高情商的产品经理的事情了。

说实话，产品经理是一门心理学，要学会猜测用户的心理。产品经理的上限更高，比程序员要高得多，但是下限也很低，趋近于负无穷。

那么，产品经理是怎么制定需求的呢？我们又能从中学到什么呢？

就让我们一起来瞧一瞧。

直播间的目的
------

大家下午一起开个需求会议，在 9 楼的 1101 房间。

......

好，大家都到了，本次会议的目的是做一个语音直播间。

我们经过调研国际市场发现，近 5 年来，语音直播的需求一直在增长，具体表现为：很多主流的社交应用都引入了语音聊天的功能，而且也开通了语音聊天室。我们发现，语音聊天室可以自由说话，没有时间限制，也不像视频直播间那样对网络要求高，市场上的几款主要社交 App 的语音功能使用量都在千万以上。

所以，我们要做个语音直播间来带动用户，为将来的其他功能铺路。

到这里，我们大概知道了产品的意思：跟风！

因为其他 App 的这个功能火了，所以觉得我们也应该顺应潮流做一个一样的需求。

跟风需求的意思就是：我们也没把握一定成功，但是别人都成功了，我们应该也行，先做出来看看再说，如果还可以，就继续做下去，否则就算了。

其实到这里，我们可以仔细想一想，既然别人能成功，说明什么？说明只要我们做得比他好，那就大概率能成功，你看腾讯的 App，有几个是原创？但是人家能抄得比原来的更好，这也是一种本事。

所以，我们可以得出一个结论：**一个 App 能火，要么是做出了别人都没有的功能，要么是抄得比别人的更好**。说白了就是：**要么有创新，要么有质量**。

很明显，我们属于后者，所以这个 App 我们一定要以质量为主，也就是代码一定要写的性能好一点。

直播间的需求
------

那么，本次需求有以下几个功能。

### 房间列表

*   首先，我们要有个房间列表，房间列表按照活跃度排序。看到房间列表，我们就应该想到分页加载逻辑了。
    
*   然后，我们要有个搜索房间的功能，要能输入房间号来搜索对应的房间。这里我们要能想到，房间号应该定义成字符串类型。因为如果定义成整型，那么 1111 和 01111 是相同的，就会出现串房的问题了。
    
*   最后，如果我自己创建有房间，则需要在底部特别展示我自己的房间，以便我能快速进入自己的房间。
    

好，列表页就这么多，我们看房间主界面。

### 房间主页面

房间主界面的排版如下：

1.  房间标题，需要显示房间名字、房间号，以及人数和设置按钮；
2.  房间麦位，有 8 个麦位（后面可能动态扩展），房主点击可以上麦以及对麦位进行`关闭/打开/踢下`等操作；
3.  消息列表，展示用户发送的文字消息，以及送礼消息；
4.  操作栏，有打开/关闭麦克风、文字输入框、发送按钮以及送礼按钮等。

看到这里，我们心里应该有个大概，房间整体是一个页面，但是上面的每一块都是可以拆分的，也就是说，我们可以定义`四块 UI`：标题栏、麦位栏、消息栏、操作栏；每一块单独实现自己的逻辑，然后把它们组装起来，就是房间的主页面了。

这就是对 UI 的单一职责，但是，不同的 UI 模块之间的数据通信，要怎么做呢？比如：我通过操作栏发了一条消息，标题栏怎么能知道我发了消息呢？

嗯，这里留个悬念，我们后面会讲。

### 礼物模块

礼物模块是重头戏，也是房间的主要收入来源。

*   首先，点击送礼按钮，唤起礼物面板，来展示不同的礼物，礼物按照价值从低到高排序。
*   点击一个礼物，可以选择要送出的数量，默认是 1 个。
*   点击的礼物要有选中的动画效果，如果选中的礼物特效还没有下载，那么就先下载这个礼物的特效，下载完了才能送出。
*   礼物支持连送，连送则连续播放，同时只能播放一个，如果连送 100 个，就 100 个依次播放。
*   礼物可以复用，其他模块也要能用这一套送礼逻辑。

好，需求很明确了，我们需要注意的就两点：

1.  礼物依次播放，也就是需要个排队的功能，那么，此时你应该能想到我们[第 11 章](https://juejin.cn/book/7196580339181944872/section/7196590186740842536 "https://juejin.cn/book/7196580339181944872/section/7196590186740842536")讲到的队列了。
2.  礼物可以复用，那么就需要把礼物单独写成一个模块了。并且礼物不能持有聊天室的逻辑，而是聊天室持有礼物。换句话说就是：**聊天室单向依赖礼物模块**。

好，这一块也没什么问题了。

### 语音模块

最后就是语音了。

*   首先，麦上的人有开麦/关麦功能，并且要有音浪表示麦上用户是否在说话。
*   其次，我们的聊天室要支持小窗功能，也就是可以退出到小窗但是声音不能停。
*   最后，语音模块也要能复用，将来我们的其他功能也需要这个语音的功能。

核心也是一个：**复用**，同样的，我们的语音也要写成一个单独的模块，并且**聊天室单向依赖语音模块**。

好，这一块到这里也结束了。

QA 和评定
------

接下来就是精彩绝伦的撕逼阶段了，瓜子阔洛矿泉水，坐看好戏，反正我这里没啥大问题。

服务器率先开撕了。

> 服务器：你这说房间列表根据活跃度排序，活跃度是怎么决定的？
> 
> 产品：根据上麦频率、送礼物频率、发消息频率得到相应的积分，综合排序即可。
> 
> 服务器：直接根据人数不行吗？人数多的排在前面。
> 
> 产品：不行，这样会导致所有人都去前面的房间，后面房间就没人了，就出现了资源不平衡，就像现实中的北上广深一样。如果根据活跃度排名，即使房间只有寥寥几人，只要聊得欢，送礼送得多，也会出现霸榜的情况，比如有的土豪就喜欢这种感觉。

(不得不说，产品这个思路还挺有道理的！)

服务器问这个目的是什么？难不成是想把排序逻辑写死？写死的话就需要客户端做了，房间列表肯定是要分页的，分页的情况下去排序肯定行不通。这不行，这我得问问了：

> 这个排序应该是服务器排好之后返回给客户端吧，客户端只负责展示就行了，不然如果放在客户端排序，就等于写死了排序逻辑，将来有调整就需要客户端发版，而且会导致老版本和新版本显示的列表顺序不一样，放在服务器就能避免这个问题。

原因都说透彻了，服务器不同意也不行。美滋滋，爽歪歪，不愧是我。

服务器又来了。

> 服务器：每个人能创建多少个房间呢？应该是只有一个吧，不然太浪费服务器资源了。
> 
> 产品：嗯，目前只能创建一个，跟用户 ID 绑定，如果后面运营得好，用户有这方面需求，有可能可以创建多个，但是不会太多。

到这里你明白什么了吗？

你应该明白，服务器想要把用户 ID 和他创建的房间号关联起来，这样来做房间列表里面“**我的房间**”的功能，但是他不知道该怎么关联，如果是一个用户只能创建一个房间，那么他就用一个`Map<String,String>`来保存，其中 key 是用户 id，value 是房间号；如果一个用户可以创建多个房间，那么他就得用`Map<String,List<String>>`来保存了。

动机我知道了，对我没啥影响，那就没啥事，机智如我。

那我也得问个问题啊，不然多没面子。

> 如果用户开麦说话过程中，有电话打过来了，要怎么办？直接关闭麦克风吗？

产品明显没想到这个问题，怔了一下，问道：

> 来电时可以关闭吗，电话挂了再打开。
> 
> 当然可以，最好再加个提示，不然用户不知道麦克风已关闭，可能会自己去手动关一下，没必要。
> 
> 好！

接下来都知道，要决定提测日期了。

得有个缓冲期，先开口为好。

> 我：这个功能，我们这边得调研下语音的 SDK，得跟 SDK 提供者沟通一下通话质量问题，可能要花费一两天。还有，那么个礼物特效，具体什么样子也不知道，得等特效出来我们看怎么绘制，所以我们这边不能给出具体的时间，只能给出个大概时间。
> 
> UI：礼物特效是个 MP4 文件，直接播放就行，应该不难吧。
> 
> 我：MP4 文件有声音，如果用户说话期间有礼物播放，怎么处理？
> 
> 产品：能让礼物静音吗？
> 
> 我：可以，这样逻辑就复杂了，而且 MP4 文件不能太大，下载也要压缩下吧；时间也不能太长，如果太长了，100 个礼物半天播不完，都得考虑下。
> 
> 产品：嗯，UI 这方面看一下。

好，成功，我们的开发周期，有了弹性的时间，这样，目的就达到了。

最后，我们也发现了，这是个功能性需求，也就是以新增为主，但是却是个抄袭的功能，抄袭就要抄得好一点，至少不能比目标差，这就要求性能要好一点了。

那么，这里面最有价值的功能是什么呢？

很明显：**语音模块和礼物模块**。

所以，我们要尽可能把这两块揽过来做，即使聊天室不行，因为这两块是复用的，也可以在其他模块显出价值。

总结
--

本章我们参与了一个语音直播间的需求评审，知道了需求的目的，也知道了自己接下来该做什么。

对于我们程序员来说，我们要注意的就是以下几点。

*   听别的开发跟产品的对话，肯定是有目的的，要能听出这个目的，危险总是悄悄到来。
*   将所有涉及到自身的不明白的地方都问明白，不仅仅局限于需求，也包括技术。
*   将所有不确定的因素提出来，并提出缓冲时间。
*   如果没有十足的把握，尽量不要给出具体的提测日期，而是给一个弹性的时间。
*   尽量做有价值的需求，尽量做有价值的需求，尽量做有价值的需求。

本篇文章基本都是教你套路的，但是没办法，有人的地方就有江湖，那么下一章，我们就开始搭建我们的直播间框架了。